  <!DOCTYPE html>
  <html lang="vi">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Tandev.foto Studio - Chỉnh sửa ảnh photobooth</title>
      <meta property="og:title" content="Tandev.foto Studio - Chỉnh sửa ảnh photobooth" />
      <meta property="og:description" content="Công cụ chỉnh sửa và tạo photobooth chuyên nghiệp, nhanh chóng và tiện lợi." />
      <meta property="og:image" content="https://i.pinimg.com/736x/e7/47/c7/e747c7057dcd237d7da58bdeceaa9025.jpg" />
      <script src="https://cdn.tailwindcss.com"></script>
      <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
      <link
        href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600&family=Permanent+Marker&display=swap"
        rel="stylesheet"
      />
        


      <style>



  /* --- Tối ưu hóa Dark Mode và Hiệu ứng chuyển động --- */

  /* Biến CSS cho màu sắc */
  :root {
    --fuji-red: #ff0000;
    --fuji-green: #00a651;
    --primary-color: #ff0000;
    --secondary-color: #333333;
    --accent-color: #00a651;
    --bg-color: #f8f9fa;
    --text-color: #333;
    --bg-card: #ffffff;
    --bg-toolbar: #f8f8f8;
    --border-color: #e2e8f0;
    --placeholder-bg: #f0f0f0;
    --placeholder-color: #999;
    --shadow-color: rgba(0, 0, 0, 0.1);
    --hover-color: #f0f0f0;
  }

  body.dark {
    --bg-color: #1a1a1a;
    --text-color: #f5f5f5;
    --secondary-color: #e0e0e0;
    --bg-card: #2d2d2d;
    --bg-toolbar: #1c1c1c;
    --border-color: #3b3b3b;
    --placeholder-bg: #444;
    --placeholder-color: #aaa;
    --shadow-color: rgba(255, 255, 255, 0.05);
    --hover-color: #3b3b3b;
  }

  /* Kiểu dáng và Chuyển đổi toàn cục */
  body {
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: background-color 0.5s ease, color 0.5s ease;
  }

  .bg-white, .bg-gray-50, .bg-gray-100, .bg-blue-50 {
    background-color: var(--bg-card) !important;
  }

  .text-gray-800, .text-blue-800 {
    color: var(--text-color) !important;
  }

  .text-gray-500 {
    color: var(--text-color) !important;
    opacity: 0.7;
  }

  .text-blue-700 {
    color: var(--text-color) !important;
    opacity: 0.8;
  }

  .border-gray-200, .border-gray-300, .border-gray-100, .border-blue-100 {
    border-color: var(--border-color) !important;
  }

  .film-frame, .sticker-item, .text-preview, .modal-content, .custom-checkbox, .custom-select select {
    background-color: var(--bg-card) !important;
    transition: all 0.3s ease;
  }

  .film-frame, .sticker-item {
    box-shadow: 0 4px 12px var(--shadow-color) !important;
  }

  .film-frame:hover {
    box-shadow: 0 8px 24px var(--shadow-color) !important;
  }

  .image-placeholder {
    background-color: var(--placeholder-bg);
    color: var(--placeholder-color);
    border-color: var(--border-color);
    transition: all 0.3s ease;
  }

  .image-placeholder:hover {
    background-color: var(--hover-color);
    border-color: var(--text-color);
    color: var(--text-color);
  }

  .tab-btn {
    color: var(--text-color);
    border-color: var(--border-color);
  }

  .tab-btn.active {
    color: var(--primary-color) !important;
  }
  .tab-btn:hover {
    color: var(--secondary-color);
  }
  .tab-btn.active:hover {
      color: var(--primary-color);
  }

  .film-strip {
    background-color: var(--secondary-color) !important;
  }

  .modal-header, .modal-footer {
    background-color: var(--bg-toolbar) !important;
  }
  .help-tooltip {
    background-color: var(--bg-card) !important;
    border-color: var(--border-color) !important;
  }
  .help-tooltip p, .help-tooltip ul, .help-tooltip li {
    color: var(--text-color) !important;
  }


  /* Dark Mode Toggle Button */
  #theme-toggle {
    position: relative;
    width: 50px;
    height: 26px;
    border-radius: 13px;
    background-color: #e0e7ff;
    cursor: pointer;
    display: flex;
    align-items: center;
    padding: 2px;
    transition: background-color 0.4s ease;
    border: 1px solid var(--border-color);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  #theme-toggle .toggle-circle {
    position: absolute;
    width: 22px;
    height: 22px;
    background-color: white;
    border-radius: 50%;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    transition: transform 0.4s ease, background-color 0.4s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  body.dark #theme-toggle {
    background-color: #2c3e50;
  }

  body.dark #theme-toggle .toggle-circle {
    transform: translateX(24px);
    background-color: var(--secondary-color);
  }

  /* Biểu tượng mặt trời và mặt trăng */
  #theme-toggle .icon-light, #theme-toggle .icon-dark {
    position: absolute;
    width: 16px;
    height: 16px;
    transition: opacity 0.4s ease, transform 0.4s ease;
  }

  #theme-toggle .icon-light {
    right: 5px;
    color: #ffcc00;
    opacity: 1;
    transform: scale(1);
  }

  #theme-toggle .icon-dark {
    left: 5px;
    color: #f5f5f5;
    opacity: 0;
    transform: scale(0);
  }

  body.dark #theme-toggle .icon-light {
    opacity: 0;
    transform: scale(0);
  }

  body.dark #theme-toggle .icon-dark {
    opacity: 1;
    transform: scale(1);
  }

  /* Biểu tượng Loading khi chuyển đổi */
  .toggle-circle .loading-spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: #fff;
      animation: spin 1s linear infinite;
      display: none;
  }

  body.dark .toggle-circle .loading-spinner {
      border: 2px solid rgba(0, 0, 0, 0.3);
      border-top-color: #000;
  }

  #theme-toggle.loading .toggle-circle .loading-spinner {
      display: block;
  }
  #theme-toggle.loading .icon-light,
  #theme-toggle.loading .icon-dark {
      display: none;
  }

        .logo-text {
          font-family: "Playfair Display", serif;
          font-weight: 700;
        }

        .film-frame {
          position: relative;
          background-color: white;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          transition: all 0.3s ease;
          overflow: hidden;
          border-radius: 4px;
          cursor: pointer;
        }

        .film-frame:hover {
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
          transform: translateY(-2px);
        }
        
        .film-frame.active-edit-frame {
          outline: 2px solid var(--primary-color);
          outline-offset: 2px;
          box-shadow: 0 8px 24px rgba(255, 0, 0, 0.4);
        }


        .film-strip {
          background-color: black;
          height: 20px;
          display: flex;
          justify-content: space-between;
          padding: 0 10px;
        }

        .film-hole {
          width: 12px;
          height: 12px;
          border-radius: 50%;
          background-color: #444;
          margin-top: 4px;
        }

        .film-date {
          position: absolute;
          bottom: 30px;
          right: 10px;
          font-family: "Courier Prime", monospace;
          font-size: 12px;
          color: rgba(255, 255, 255, 0.8);
          background-color: rgba(0, 0, 0, 0.5);
          padding: 2px 6px;
          border-radius: 2px;
          z-index: 5;
        }

        .film-brand {
          position: absolute;
          top: 30px;
          left: 10px;
          font-family: "Courier Prime", monospace;
          font-weight: bold;
          font-size: 14px;
          color: rgba(255, 255, 255, 0.9);
          background-color: rgba(255, 0, 0, 0.7);
          padding: 2px 6px;
          border-radius: 2px;
          z-index: 5;
        }

        .image-placeholder {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          background-color: #f0f0f0;
          color: #999;
          font-size: 48px;
          cursor: pointer;
          min-height: 200px;
          transition: all 0.2s ease;
          position: relative;
          border: 2px dashed #ccc;
          border-radius: 4px;
        }

        .image-placeholder:hover {
          background-color: #e0e0e0;
          color: #777;
          border-color: #999;
        }

        .image-placeholder-text {
          font-size: 14px;
          color: #777;
          margin-top: 10px;
        }

        .image-container {
          position: relative;
          overflow: hidden;
          min-height: 200px;
          border-radius: 0 0 4px 4px;
        }

        .image-container img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: filter 0.3s ease;
        }
        
        .image-container .effect-overlay {
          position: absolute;
          inset: 0;
          pointer-events: none;
        }

        .image-actions {
          position: absolute;
          top: 10px;
          right: 10px;
          display: flex;
          gap: 8px;
          z-index: 10;
          opacity: 0;
          transition: opacity 0.2s ease;
          backdrop-filter: blur(2px);
        }

        .image-container:hover .image-actions {
          opacity: 1;
        }

        .action-btn {
          background-color: rgba(0, 0, 0, 0.6);
          color: white;
          border: none;
          border-radius: 50%;
          width: 36px;
          height: 36px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: all 0.2s ease;
          backdrop-filter: blur(2px);
        }

        .action-btn:hover {
          background-color: rgba(0, 0, 0, 0.8);
          transform: scale(1.1);
        }

        .tab-content {
          display: none;
          animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
          display: block;
        }

        @keyframes fadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        .slider-container {
          position: relative;
          padding: 10px 0;
        }

        .slider {
          -webkit-appearance: none;
          width: 100%;
          height: 6px;
          border-radius: 3px;
          background: #e0e0e0;
          outline: none;
          transition: background 0.2s;
        }

        .slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          background: var(--primary-color);
          cursor: pointer;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
          transition: all 0.2s;
        }

        .slider::-webkit-slider-thumb:hover {
          transform: scale(1.1);
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
        }

        .slider::-moz-range-thumb {
          width: 20px;
          height: 20px;
          border-radius: 50%;
          background: var(--primary-color);
          cursor: pointer;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
          transition: all 0.2s;
          border: none;
        }

        .slider::-moz-range-thumb:hover {
          transform: scale(1.1);
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
        }

        .slider-value {
          position: absolute;
          top: -20px;
          right: 0;
          font-size: 12px;
          font-weight: 500;
          color: #666;
          background-color: #f0f0f0;
          padding: 2px 6px;
          border-radius: 10px;
          transition: all 0.2s;
        }

        .sticker {
          position: absolute;
          cursor: grab;
          user-select: none;
          z-index: 10;
          filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }
        
        .sticker:active {
          cursor: grabbing;
        }

        .sticker .sticker-handle {
          position: absolute;
          bottom: 0;
          right: 0;
          width: 24px;
          height: 24px;
          background-color: rgba(255, 255, 255, 0.8);
          border: 2px solid var(--primary-color);
          border-radius: 50%;
          display: none;
          align-items: center;
          justify-content: center;
          cursor: se-resize;
          z-index: 11;
          transform: translate(50%, 50%);
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .sticker .sticker-remove {
          position: absolute;
          top: 0;
          right: 0;
          width: 24px;
          height: 24px;
          background-color: rgba(255, 0, 0, 0.8);
          border-radius: 50%;
          display: none;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          z-index: 11;
          transform: translate(50%, -50%);
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
          color: white;
          font-size: 14px;
          font-weight: bold;
        }
        
        .sticker:hover .sticker-handle,
        .sticker:hover .sticker-remove {
            display: flex;
        }

        .sticker img, .sticker svg {
          pointer-events: none;
          user-select: none;
        }

        .polaroid {
          padding-bottom: 40px;
          background-color: white;
        }

        .polaroid-caption {
          position: absolute;
          bottom: 10px;
          width: 100%;
          text-align: center;
          font-family: "Permanent Marker", cursive;
          color: #333;
          padding: 0 10px;
        }

        .flash {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: white;
          opacity: 0;
          z-index: 9999;
          pointer-events: none;
        }

        .flash-animation {
          animation: flash 0.5s ease-out;
        }

        @keyframes flash {
          0% {
            opacity: 0;
          }
          50% {
            opacity: 1;
          }
          100% {
            opacity: 0;
          }
        }

        .notification {
          position: fixed;
          bottom: 20px;
          right: 20px;
          background-color: #333;
          color: white;
          padding: 12px 20px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          transform: translateY(100px);
          opacity: 0;
          transition: all 0.3s ease;
          z-index: 1000;
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .notification.show {
          transform: translateY(0);
          opacity: 1;
        }

.film-frame.selected-all {
    outline: 2px dashed var(--accent-color);
    outline-offset: 2px;
}
.film-frame.processing {
    cursor: wait;
    opacity: 0.7;
}

        .filmstrip-container {
          display: flex;
          overflow-x: auto;
          padding: 20px 0;
          scroll-behavior: smooth;
          scrollbar-width: thin;
          scrollbar-color: var(--primary-color) #f0f0f0;
        }

        .filmstrip-container::-webkit-scrollbar {
          height: 6px;
        }

        .filmstrip-container::-webkit-scrollbar-track {
          background: #f0f0f0;
          border-radius: 3px;
        }

        .filmstrip-container::-webkit-scrollbar-thumb {
          background-color: var(--primary-color);
          border-radius: 3px;
        }

        .collage-layout {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          grid-template-rows: repeat(3, 1fr);
          gap: 10px;
          height: 600px;
        }

        .collage-layout .film-frame:nth-child(1) {
          grid-column: 1 / 3;
          grid-row: 1 / 3;
        }

        .tooltip {
          position: relative;
          display: inline-block;
        }

        .tooltip .tooltiptext {
          visibility: hidden;
          width: 140px;
          background-color: rgba(0, 0, 0, 0.8);
          color: #fff;
          text-align: center;
          border-radius: 6px;
          padding: 6px 8px;
          position: absolute;
          z-index: 1;
          bottom: 125%;
          left: 50%;
          transform: translateX(-50%);
          opacity: 0;
          transition: opacity 0.3s, transform 0.3s;
          font-size: 12px;
          font-weight: 500;
          pointer-events: none;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .tooltip .tooltiptext::after {
          content: "";
          position: absolute;
          top: 100%;
          left: 50%;
          margin-left: -5px;
          border-width: 5px;
          border-style: solid;
          border-color: rgba(0, 0, 0, 0.8) transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
          visibility: visible;
          opacity: 1;
          transform: translateX(-50%) translateY(-5px);
        }

        .btn-primary {
          background-color: var(--primary-color);
          color: white;
          transition: all 0.2s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
          border-radius: 6px;
          font-weight: 500;
          box-shadow: 0 2px 4px rgba(255, 0, 0, 0.2);
        }

        .btn-primary:hover {
          background-color: #e60000;
          transform: translateY(-1px);
          box-shadow: 0 4px 8px rgba(255, 0, 0, 0.3);
        }

        .btn-primary:active {
          transform: translateY(0);
          box-shadow: 0 1px 2px rgba(255, 0, 0, 0.3);
        }

        .btn-secondary {
          background-color: var(--secondary-color);
          color: white;
          transition: all 0.2s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
          border-radius: 6px;
          font-weight: 500;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary:hover {
          background-color: #222;
          transform: translateY(-1px);
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary:active {
          transform: translateY(0);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .btn-accent {
          background-color: var(--accent-color);
          color: white;
          transition: all 0.2s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
          border-radius: 6px;
          font-weight: 500;
          box-shadow: 0 2px 4px rgba(0, 166, 81, 0.2);
        }

        .btn-accent:hover {
          background-color: #008c44;
          transform: translateY(-1px);
          box-shadow: 0 4px 8px rgba(0, 166, 81, 0.3);
        }

        .btn-accent:active {
          transform: translateY(0);
          box-shadow: 0 1px 2px rgba(0, 166, 81, 0.3);
        }

        .filter-preview {
          width: 100%;
          height: 70px;
          background-size: cover;
          background-position: center;
          border-radius: 6px;
          margin-bottom: 6px;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          transition: transform 0.2s;
        }

        .filter-option {
          transition: all 0.2s ease;
          border-radius: 8px;
          padding: 8px;
          cursor: pointer;
          border: 2px solid transparent;
        }

        .filter-option:hover {
          background-color: #f0f0f0;
          transform: translateY(-2px);
        }

        .filter-option.active {
          background-color: rgba(255, 0, 0, 0.05);
          border: 2px solid var(--primary-color);
          box-shadow: 0 2px 8px rgba(255, 0, 0, 0.1);
        }

        .filter-option input[type="radio"] {
          accent-color: var(--primary-color);
          width: 18px;
          height: 18px;
        }

        .frame-type-btn,
        .frame-color-btn,
        .text-position-btn,
        .text-size-btn {
          transition: all 0.2s ease;
          border-radius: 6px;
          overflow: hidden;
          position: relative;
        }

        .frame-type-btn:hover,
        .frame-color-btn:hover,
        .text-position-btn:hover,
        .text-size-btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .frame-type-btn.active,
        .frame-color-btn.active,
        .text-position-btn.active,
        .text-size-btn.active {
          border: 2px solid var(--primary-color);
          font-weight: 500;
        }

        .frame-type-btn::after,
        .frame-color-btn::after,
        .text-position-btn::after,
        .text-size-btn::after {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(255, 0, 0, 0.1);
          opacity: 0;
          transition: opacity 0.2s;
          pointer-events: none;
        }

        .frame-type-btn:hover::after,
        .frame-color-btn:hover::after,
        .text-position-btn:hover::after,
        .text-size-btn:hover::after {
          opacity: 1;
        }

        .text-color-btn {
          transition: all 0.2s ease;
          border: 2px solid transparent;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .text-color-btn:hover {
          transform: scale(1.1);
          box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }

        .text-color-btn.active {
          border: 2px solid #333;
          transform: scale(1.1);
          box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        }

        .sticker-item {
          transition: all 0.2s ease;
          border-radius: 8px;
          overflow: hidden;
        }

        .sticker-item:hover {
          transform: translateY(-3px);
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .sticker-item:active {
          transform: scale(0.95);
        }

        .editor-help {
          position: absolute;
          top: 10px;
          right: 10px;
          background-color: rgba(0, 0, 0, 0.6);
          color: white;
          width: 28px;
          height: 28px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          font-size: 14px;
          font-weight: bold;
          transition: all 0.2s;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .editor-help:hover {
          background-color: rgba(0, 0, 0, 0.8);
          transform: scale(1.1);
        }

        .help-tooltip {
          position: absolute;
          top: 40px;
          right: 0;
          width: 280px;
          background-color: white;
          border-radius: 8px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
          padding: 15px;
          font-size: 13px;
          display: none;
          z-index: 100;
          border: 1px solid #eee;
        }

        .editor-help:hover .help-tooltip {
          display: block;
        }

        .progress-bar {
          height: 6px;
          background-color: #e0e0e0;
          border-radius: 3px;
          overflow: hidden;
          margin-top: 6px;
        }

        .progress-fill {
          height: 100%;
          background-color: var(--primary-color);
          width: 0%;
          transition: width 0.3s ease;
          border-radius: 3px;
        }

        .onboarding-tooltip {
          position: absolute;
          background-color: white;
          border-radius: 8px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
          padding: 12px 18px;
          font-size: 14px;
          z-index: 1000;
          max-width: 280px;
          animation: pulse 2s infinite;
        }

        @keyframes pulse {
          0% {
            box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.4);
          }
          70% {
            box-shadow: 0 0 0 10px rgba(255, 0, 0, 0);
          }
          100% {
            box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
          }
        }

        .onboarding-tooltip::after {
          content: "";
          position: absolute;
          border-width: 10px;
          border-style: solid;
        }

        .onboarding-tooltip.bottom::after {
          top: -20px;
          left: 50%;
          margin-left: -10px;
          border-color: transparent transparent white transparent;
        }

        .onboarding-tooltip.top::after {
          bottom: -20px;
          left: 50%;
          margin-left: -10px;
          border-color: white transparent transparent transparent;
        }

        .onboarding-tooltip.left::after {
          right: -20px;
          top: 50%;
          margin-top: -10px;
          border-color: transparent transparent transparent white;
        }

        .onboarding-tooltip.right::after {
          left: -20px;
          top: 50%;
          margin-top: -10px;
          border-color: transparent white transparent transparent;
        }

        .onboarding-tooltip .btn-next {
          background-color: var(--primary-color);
          color: white;
          border: none;
          padding: 6px 12px;
          border-radius: 6px;
          margin-top: 10px;
          cursor: pointer;
          font-size: 13px;
          font-weight: 500;
          transition: all 0.2s;
          display: inline-flex;
          align-items: center;
          gap: 5px;
        }

        .onboarding-tooltip .btn-next:hover {
          background-color: #e60000;
          transform: translateY(-1px);
        }

        /* Custom checkbox styling */
        .custom-checkbox {
          display: flex;
          align-items: center;
          background-color: #f8f8f8;
          padding: 10px;
          border-radius: 8px;
          transition: all 0.2s;
          cursor: pointer;
          border: 1px solid #eee;
        }

        .custom-checkbox:hover {
          background-color: #f0f0f0;
          border-color: #ddd;
        }

        .custom-checkbox input[type="checkbox"] {
          appearance: none;
          -webkit-appearance: none;
          width: 20px;
          height: 20px;
          border: 2px solid #ccc;
          border-radius: 4px;
          margin-right: 10px;
          position: relative;
          transition: all 0.2s;
          cursor: pointer;
        }

        .custom-checkbox input[type="checkbox"]:checked {
          background-color: var(--primary-color);
          border-color: var(--primary-color);
        }

        .custom-checkbox input[type="checkbox"]:checked::after {
          content: "✓";
          position: absolute;
          color: white;
          font-size: 14px;
          font-weight: bold;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
        }

.background-option-label {
    display: block;
    cursor: pointer;
}
.background-option-label input[type="radio"] {
    display: none;
}
.background-option-label input[type="radio"]:checked + div {
    border-color: var(--primary-color);
}


        .custom-checkbox label {
          cursor: pointer;
        }
        
        .custom-checkbox.select-all {
          border-color: var(--accent-color);
          background-color: #f0fff4;
        }

        /* Custom select styling */
        .custom-select {
          position: relative;
          display: inline-block;
        }

        .custom-select select {
          appearance: none;
          -webkit-appearance: none;
          padding-right: 30px;
          background-color: white;
          cursor: pointer;
          border-radius: 6px;
          transition: all 0.2s;
          border: 1px solid #ddd;
        }

        .custom-select::after {
          content: "▼";
          font-size: 12px;
          position: absolute;
          right: 10px;
          top: 50%;
          transform: translateY(-50%);
          pointer-events: none;
          color: #666;
        }

        .custom-select select:hover {
          border-color: #bbb;
        }

        .custom-select select:focus {
          border-color: var(--primary-color);
          box-shadow: 0 0 0 2px rgba(255, 0, 0, 0.1);
          outline: none;
        }

        /* Tab styling improvements */
        .tab-btn {
          position: relative;
          transition: all 0.2s;
          font-weight: 500;
        }

        .tab-btn::after {
          content: "";
          position: absolute;
          bottom: -2px;
          left: 0;
          width: 100%;
          height: 2px;
          background-color: var(--primary-color);
          transform: scaleX(0);
          transition: transform 0.3s;
        }

        .tab-btn.active::after {
          transform: scaleX(1);
        }

        .tab-btn:hover::after {
          transform: scaleX(0.5);
        }

        /* Text preview improvements */
        .text-preview {
          border-radius: 8px;
          overflow: hidden;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          transition: all 0.2s;
        }

        .text-preview:hover {
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Modal improvements */
        .modal {
          animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .modal-content {
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
          background-color: #f8f8f8;
          border-bottom: 1px solid #eee;
        }

        .modal-footer {
          background-color: #f8f8f8;
          border-top: 1px solid #eee;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
          .main-container {
            flex-direction: column;
          }

          .gallery-column,
          .editor-column {
            width: 100%;
          }
          
          .gallery-column {
              order: 1; /* Hiển thị bộ sưu tập trước */
              height: auto;
          }
          
          .editor-column {
              order: 2; /* Phần chỉnh sửa xuống dưới */
          }


          .collage-layout {
            height: 400px;
          }

          .tab-btn {
            padding: 10px;
            font-size: 14px;
          }

          .editor-column {
            position: relative;
            z-index: 20;
            margin-top: 20px;
          }

          .mobile-tabs {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding-bottom: 5px;
          }

          .mobile-tabs::-webkit-scrollbar {
            display: none;
          }

          .filter-option {
            padding: 6px;
          }

          .btn-primary,
          .btn-secondary,
          .btn-accent {
            padding: 8px 12px;
            font-size: 14px;
          }
          
          .footer-mobile-hidden {
            display: none;
          }
          
          .sticker-item img {
            width: 48px;
            height: 48px;
          }
        }

        /* Accessibility improvements */
        :focus {
          outline: 2px solid var(--primary-color);
          outline-offset: 2px;
        }

        .focus-visible:focus:not(:focus-visible) {
          outline: none;
        }



        /* Loading indicators */
        .loading-spinner {
          width: 24px;
          height: 24px;
          border: 3px solid rgba(255, 255, 255, 0.3);
          border-radius: 50%;
          border-top-color: white;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to {
            transform: rotate(360deg);
          }
        }

        /* Badge indicators */
        .badge {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          background-color: var(--primary-color);
          color: white;
          border-radius: 12px;
          padding: 2px 8px;
          font-size: 12px;
          font-weight: 500;
        }

        /* Improved scrollbars */
        .custom-scrollbar {
          scrollbar-width: thin;
          scrollbar-color: var(--primary-color) #f0f0f0;
        }

        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f0f0f0;
          border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
          background-color: var(--primary-color);
          border-radius: 3px;
        }
      </style>
    </head>
    <body class="min-h-screen flex flex-col">
      <div id="flash" class="flash"></div>

      <div id="notification" class="notification">
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 13l4 4L19 7"
          ></path>
        </svg>
        <span>Thao tác thành công!</span>
      </div>

      <header
        class="bg-gradient-to-r from-black to-gray-800 text-white py-4 px-6 shadow-lg"
      >
        <div
          class="container mx-auto flex flex-col md:flex-row justify-between items-center"
        >
          <div class="flex items-center mb-3 md:mb-0">
            <div class="mr-3 relative">
              <svg
                width="40"
                height="40"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                class="drop-shadow"
              >
                <rect width="24" height="24" rx="6" fill="#FF0000" />
                <path d="M4 7H20V17H4V7Z" fill="white" />
                <path d="M6 9H18V15H6V9Z" fill="#FF0000" />
                <path d="M8 11H16V13H8V11Z" fill="white" />
              </svg>
              <div
                class="absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping"
              ></div>
            </div>
            <div>
              <h1 class="logo-text text-xl md:text-2xl font-bold text-shadow">
                Tandev.foto Studio
              </h1>
              <p class="text-xs md:text-sm text-gray-300">
                Tạo bộ sưu tập ảnh với phong cách film Fujifilm chuyên nghiệp
              </p>
            </div>
          </div>
          
          <div class="flex gap-3 items-center">
  <button id="theme-toggle" class="relative w-12 h-6 rounded-full p-1 transition-colors duration-500 bg-gray-200 shadow-inner">
    <div class="toggle-circle w-4 h-4 bg-white rounded-full shadow-md transform transition-transform duration-500">
      <div class="loading-spinner"></div>
      <svg class="icon-dark w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 12c0 5.385 4.365 9.75 9.75 9.75c2.022 0 3.963-.604 5.572-1.652z" />
      </svg>
      <svg class="icon-light w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.364l-1.591 1.591M21 12h-2.25m-.364 6.364l-1.591-1.591M12 18.75V21m-4.364-.364l1.591-1.591M3 12h2.25m-.364-6.364l1.591 1.591M12 12a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" />
      </svg>
    </div>
  </button>
            <div class="tooltip">
              <button id="captureBtn" class="btn-primary px-4 py-2 rounded-md">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"
                  ></path>
                </svg>
                Chụp ảnh
              </button>
              <span class="tooltiptext">Chụp ảnh từ webcam của bạn</span>
            </div>
            <div class="tooltip">
              <button id="helpBtn" class="btn-secondary px-3 py-2 rounded-md">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
                Hướng dẫn
              </button>
              <span class="tooltiptext">Xem hướng dẫn sử dụng</span>
            </div>
          </div>
        </div>
      </header>

      <main class="flex-grow py-6 px-4 bg-gray-50">
        <div
          class="container mx-auto main-container flex flex-col md:flex-row gap-6"
        >
          <div
            class="gallery-column w-full md:w-3/4 bg-white rounded-xl shadow-lg p-6"
          >
            <div
              class="flex flex-wrap justify-between items-center mb-6 pb-4 border-b border-gray-200"
            >
              <div class="flex gap-3 mb-3 md:mb-0">
                <div class="tooltip">
                  <button id="addFrameBtn" class="btn-primary px-4 py-2 rounded-md">
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                      ></path>
                    </svg>
                    Thêm khung
                  </button>
                  <span class="tooltiptext"
                    >Thêm khung ảnh mới vào bộ sưu tập</span
                  >
                </div>
                <div class="tooltip">
                  <button
                    id="clearAllBtn"
                    class="btn-secondary px-4 py-2 rounded-md"
                  >
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                      ></path>
                    </svg>
                    Xóa tất cả
                  </button>
                  <span class="tooltiptext">Xóa tất cả khung ảnh</span>
                </div>
              </div>
              <div class="flex items-center">
                <label class="text-sm mr-3 font-medium">Bố cục:</label>
                <div class="tooltip custom-select">
                  <select
                    id="layoutSelector"
                    class="border border-gray-300 rounded-md px-3 py-2 text-sm bg-white focus:border-red-500 focus:ring focus:ring-red-200 focus:ring-opacity-50"
                  >
                    <option value="grid">Lưới (2x2)</option>
                    <option value="vertical">Dọc (1 cột)</option>
                    <option value="horizontal">Ngang (1 hàng)</option>
                    <option value="combined">Kết hợp (1 lớn + 3 nhỏ)</option>
                    <option value="polaroid">Polaroid</option>
                    <option value="collage">Collage</option>
                    <option value="filmstrip">Filmstrip</option>
                  </select>
                  <span class="tooltiptext">Chọn kiểu bố cục cho bộ sưu tập</span>
                </div>
              </div>
            </div>

            <div id="galleryContainer" class="grid grid-cols-2 gap-6">
              <div class="film-frame" id="frame-0">
                <div class="film-strip">
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                </div>
                <div class="image-placeholder">
                  <svg
                    class="w-16 h-16 text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                    ></path>
                  </svg>
                  <span class="image-placeholder-text">Nhấp để thêm ảnh</span>
                </div>
                <div class="film-strip">
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                </div>
              </div>

              <div class="film-frame active-edit-frame" id="frame-1">
                <div class="film-strip">
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                </div>
                <div class="image-container">
                  <img
                    src="https://source.unsplash.com/featured/?nature"
                    alt="Sample image"
                    class="edited-image"
                  />
                  <div class="film-date">2023-10-15</div>
                  <div class="film-brand">FUJIFILM</div>
                  <div class="image-actions">
                    <button class="action-btn edit-btn" title="Chỉnh sửa">
                      <svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
                        ></path>
                      </svg>
                    </button>
                    <button class="action-btn delete-btn" title="Xóa">
                      <svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                        ></path>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="film-strip">
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                </div>
              </div>

              <div class="film-frame" id="frame-2">
                <div class="film-strip">
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                </div>
                <div class="image-container">
                  <img
                    src="https://source.unsplash.com/featured/?city"
                    alt="Sample image"
                    class="edited-image"
                    style="filter: contrast(1.1) brightness(1) saturate(0.9)"
                  />
                  <div class="film-date">2023-10-16</div>
                  <div class="film-brand">FUJIFILM</div>
                  <div class="image-actions">
                    <button class="action-btn edit-btn" title="Chỉnh sửa">
                      <svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
                        ></path>
                      </svg>
                    </button>
                    <button class="action-btn delete-btn" title="Xóa">
                      <svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                        ></path>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="film-strip">
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                </div>
              </div>

              <div class="film-frame" id="frame-3">
                <div class="film-strip">
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                </div>
                <div class="image-container">
                  <img
                    src="https://source.unsplash.com/featured/?portrait"
                    alt="Sample image"
                    class="edited-image"
                    style="filter: grayscale(1) contrast(1.2)"
                  />
                  <div class="film-date">2023-10-17</div>
                  <div class="film-brand">FUJIFILM</div>
                  <div class="image-actions">
                    <button class="action-btn edit-btn" title="Chỉnh sửa">
                      <svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
                        ></path>
                      </svg>
                    </button>
                    <button class="action-btn delete-btn" title="Xóa">
                      <svg
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                        ></path>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="film-strip">
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                  <div class="film-hole"></div>
                </div>
              </div>
            </div>

            <div class="mt-8 flex justify-center gap-4">
              <div class="tooltip">
                <button id="downloadBtn" class="btn-accent px-6 py-3 rounded-md">
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                    ></path>
                  </svg>
                  Tải xuống
                </button>
                <span class="tooltiptext">Lưu bộ sưu tập dưới dạng ảnh PNG</span>
              </div>
              <div class="tooltip">
                <button id="shareBtn" class="btn-primary px-6 py-3 rounded-md">
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"
                    ></path>
                  </svg>
                  Chia sẻ
                </button>
                <span class="tooltiptext"
                  >Chia sẻ bộ sưu tập lên mạng xã hội</span
                >
              </div>
            </div>
          </div>

          <div
            class="editor-column w-full md:w-1/4 bg-white rounded-xl shadow-lg p-6 relative"
          >
            <div class="editor-help">
              ?
              <div class="help-tooltip">
                <p class="font-medium mb-2 text-gray-800">Hướng dẫn chỉnh sửa:</p>
                <ul class="list-disc pl-4 space-y-2 text-gray-600">
                  <li>Chọn bộ lọc để thay đổi màu sắc</li>
                  <li>Điều chỉnh hiệu ứng để tạo cảm giác film</li>
                  <li>Thêm chữ và sticker để trang trí ảnh</li>
                  <li>Nhấp vào "+" để thêm ảnh từ thiết bị</li>
                </ul>
              </div>
            </div>

            <div class="flex border-b border-gray-200 mobile-tabs">
              <button
                class="tab-btn py-3 px-4 border-b-2 border-red-500 text-red-500 font-medium active"
                data-tab="filters"
              >
                <div class="flex items-center">
                  <svg
                    class="w-4 h-4 mr-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                    ></path>
                  </svg>
                  Bộ lọc
                </div>
              </button>
              <button
                class="tab-btn py-3 px-4 border-b-2 border-transparent hover:text-gray-600"
                data-tab="effects"
              >
                <div class="flex items-center">
                  <svg
                    class="w-4 h-4 mr-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
                    ></path>
                  </svg>
                  Hiệu ứng
                </div>
              </button>
              <button
                class="tab-btn py-3 px-4 border-b-2 border-transparent hover:text-gray-600"
                data-tab="text"
              >
                <div class="flex items-center">
                  <svg
                    class="w-4 h-4 mr-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"
                    ></path>
                  </svg>
                  Chữ
                </div>
              </button>
              <button
                class="tab-btn py-3 px-4 border-b-2 border-transparent hover:text-gray-600"
                data-tab="stickers"
              >
                <div class="flex items-center">
                  <svg
                    class="w-4 h-4 mr-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
                    ></path>
                  </svg>
                  Sticker
                </div>
              </button>
            </div>

            <div
              id="filtersTab"
              class="tab-content active py-4 custom-scrollbar"
              style="max-height: 70vh; overflow-y: auto"
            >
              <div class="mb-4">
                  <div class="custom-checkbox select-all">
                      <input type="checkbox" id="selectAllFrames" />
                      <div class="flex items-center">
                          <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                          <label for="selectAllFrames" class="text-sm font-medium text-green-800">Áp dụng cho tất cả khung hình</label>
                      </div>
                  </div>
              </div>
              <h3 class="font-medium mb-4 flex items-center text-gray-800">
                <svg
                  class="w-5 h-5 mr-2 text-red-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                  ></path>
                </svg>
                Bộ lọc Fujifilm
                <span class="badge ml-2">12</span>
              </h3>
              <div class="space-y-3">
                <div
                  class="filter-option flex items-center active"
                  data-filter="none"
                >
                  <input
                    type="radio"
                    id="filter-none"
                    name="filter"
                    value="none"
                    checked
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-none" class="text-sm font-medium"
                        >Không có bộ lọc</label
                      >
                      <span class="text-xs px-2 py-1 bg-gray-100 rounded-full"
                        >Gốc</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">Ảnh gốc không chỉnh sửa</p>
                  </div>
                </div>
                <div class="filter-option flex items-center" data-filter="provia">
                  <input
                    type="radio"
                    id="filter-provia"
                    name="filter"
                    value="provia"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: contrast(1.15) brightness(1) saturate(1.1);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-provia" class="text-sm font-medium"
                        >Provia</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-blue-50 text-blue-600 rounded-full"
                        >Cân bằng</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Màu sắc cân bằng, độ tương phản vừa phải
                    </p>
                  </div>
                </div>
                <div class="filter-option flex items-center" data-filter="velvia">
                  <input
                    type="radio"
                    id="filter-velvia"
                    name="filter"
                    value="velvia"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: contrast(1.3) brightness(1) saturate(1.5);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-velvia" class="text-sm font-medium"
                        >Velvia</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-red-50 text-red-600 rounded-full"
                        >Rực rỡ</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Màu sắc rực rỡ, độ tương phản cao
                    </p>
                  </div>
                </div>
                <div class="filter-option flex items-center" data-filter="astia">
                  <input
                    type="radio"
                    id="filter-astia"
                    name="filter"
                    value="astia"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: contrast(1) brightness(1.05) saturate(0.9);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-astia" class="text-sm font-medium"
                        >Astia</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-pink-50 text-pink-600 rounded-full"
                        >Nhẹ nhàng</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Tông màu nhẹ nhàng, phù hợp chân dung
                    </p>
                  </div>
                </div>
                <div
                  class="filter-option flex items-center"
                  data-filter="classic-chrome"
                >
                  <input
                    type="radio"
                    id="filter-classic-chrome"
                    name="filter"
                    value="classic-chrome"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: contrast(1.1) brightness(0.95) saturate(0.75)
                          sepia(0.1);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label
                        for="filter-classic-chrome"
                        class="text-sm font-medium"
                        >Classic Chrome</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-yellow-50 text-yellow-600 rounded-full"
                        >Cổ điển</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Màu sắc cổ điển, độ bão hòa thấp
                    </p>
                  </div>
                </div>
                <div class="filter-option flex items-center" data-filter="acros">
                  <input
                    type="radio"
                    id="filter-acros"
                    name="filter"
                    value="acros"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: contrast(1.2) brightness(1) saturate(0)
                          sepia(0.05);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-acros" class="text-sm font-medium"
                        >Acros</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-gray-800 text-white rounded-full"
                        >Đen trắng</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Đen trắng cao cấp, độ tương phản cao
                    </p>
                  </div>
                </div>
                <div
                  class="filter-option flex items-center"
                  data-filter="monochrome"
                >
                  <input
                    type="radio"
                    id="filter-monochrome"
                    name="filter"
                    value="monochrome"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: grayscale(1) contrast(1.2);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-monochrome" class="text-sm font-medium"
                        >Monochrome</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-gray-600 text-white rounded-full"
                        >Đen trắng</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Đen trắng cổ điển, chi tiết rõ nét
                    </p>
                  </div>
                </div>
                <div class="filter-option flex items-center" data-filter="sepia">
                  <input
                    type="radio"
                    id="filter-sepia"
                    name="filter"
                    value="sepia"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: sepia(0.8) contrast(1.1);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-sepia" class="text-sm font-medium"
                        >Sepia</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-amber-50 text-amber-600 rounded-full"
                        >Nâu cổ điển</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Hiệu ứng nâu cổ điển, hoài niệm
                    </p>
                  </div>
                </div>
                <div
                  class="filter-option flex items-center"
                  data-filter="pro-neg-hi"
                >
                  <input
                    type="radio"
                    id="filter-pro-neg-hi"
                    name="filter"
                    value="pro-neg-hi"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: contrast(1.1) brightness(1) saturate(0.9);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-pro-neg-hi" class="text-sm font-medium"
                        >Pro Neg. Hi</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-indigo-50 text-indigo-600 rounded-full"
                        >Chuyên nghiệp</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Tương phản cao, màu sắc chuyên nghiệp
                    </p>
                  </div>
                </div>
                <div
                  class="filter-option flex items-center"
                  data-filter="pro-neg-std"
                >
                  <input
                    type="radio"
                    id="filter-pro-neg-std"
                    name="filter"
                    value="pro-neg-std"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: contrast(1) brightness(1) saturate(0.8);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-pro-neg-std" class="text-sm font-medium"
                        >Pro Neg. Std</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-violet-50 text-violet-600 rounded-full"
                        >Chân dung</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Tông màu da tự nhiên, phù hợp chân dung
                    </p>
                  </div>
                </div>
                <div class="filter-option flex items-center" data-filter="eterna">
                  <input
                    type="radio"
                    id="filter-eterna"
                    name="filter"
                    value="eterna"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: contrast(0.9) brightness(1.05) saturate(0.85);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-eterna" class="text-sm font-medium"
                        >Eterna</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-green-50 text-green-600 rounded-full"
                        >Điện ảnh</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Phong cách điện ảnh, màu nhẹ nhàng
                    </p>
                  </div>
                </div>
                <div
                  class="filter-option flex items-center"
                  data-filter="classic"
                >
                  <input
                    type="radio"
                    id="filter-classic"
                    name="filter"
                    value="classic"
                    class="mr-3"
                  />
                  <div class="w-full">
                    <div
                      class="filter-preview"
                      style="
                        background-image: url('https://source.unsplash.com/featured/?nature');
                        filter: contrast(1.1) brightness(1.1) saturate(1.3)
                          sepia(0.2);
                      "
                    ></div>
                    <div class="flex justify-between items-center">
                      <label for="filter-classic" class="text-sm font-medium"
                        >Classic</label
                      >
                      <span
                        class="text-xs px-2 py-1 bg-orange-50 text-orange-600 rounded-full"
                        >Vintage</span
                      >
                    </div>
                    <p class="text-xs text-gray-500">
                      Hiệu ứng film cổ điển, ấm áp
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div
              id="effectsTab"
              class="tab-content py-4 custom-scrollbar"
              style="max-height: 70vh; overflow-y: auto"
            >
              <div class="mb-4">
                  <div class="custom-checkbox select-all">
                      <input type="checkbox" id="selectAllEffects" />
                      <div class="flex items-center">
                          <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                          <label for="selectAllEffects" class="text-sm font-medium text-green-800">Áp dụng cho tất cả khung hình</label>
                      </div>
                  </div>
              </div>
              <div class="space-y-6">
                <div>
                  <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-medium text-gray-800"
                      >Hạt film</label
                    >
                    <span
                      id="grainValue"
                      class="text-xs font-medium bg-gray-100 px-3 py-1 rounded-full"
                      >0%</span
                    >
                  </div>
                  <div class="slider-container">
                    <input
                      type="range"
                      min="0"
                      max="100"
                      value="0"
                      class="slider"
                      id="grainSlider"
                    />
                    <div class="progress-bar">
                      <div
                        id="grainProgress"
                        class="progress-fill"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                  <p class="text-xs text-gray-500 mt-2 flex items-center">
                    <svg
                      class="w-4 h-4 mr-1 text-yellow-500"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                    Thêm hiệu ứng hạt film để tạo cảm giác chân thực
                  </p>
                </div>

                <div>
                  <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-medium text-gray-800"
                      >Rò sáng</label
                    >
                    <span
                      id="leakValue"
                      class="text-xs font-medium bg-gray-100 px-3 py-1 rounded-full"
                      >0%</span
                    >
                  </div>
                  <div class="slider-container">
                    <input
                      type="range"
                      min="0"
                      max="100"
                      value="0"
                      class="slider"
                      id="leakSlider"
                    />
                    <div class="progress-bar">
                      <div
                        id="leakProgress"
                        class="progress-fill"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                  <p class="text-xs text-gray-500 mt-2 flex items-center">
                    <svg
                      class="w-4 h-4 mr-1 text-yellow-500"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                    Thêm hiệu ứng rò sáng như film bị lỗi
                  </p>
                </div>

                <div>
                  <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-medium text-gray-800"
                      >Viền tối</label
                    >
                    <span
                      id="vignetteValue"
                      class="text-xs font-medium bg-gray-100 px-3 py-1 rounded-full"
                      >0%</span
                    >
                  </div>
                  <div class="slider-container">
                    <input
                      type="range"
                      min="0"
                      max="100"
                      value="0"
                      class="slider"
                      id="vignetteSlider"
                    />
                    <div class="progress-bar">
                      <div
                        id="vignetteProgress"
                        class="progress-fill"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                  <p class="text-xs text-gray-500 mt-2 flex items-center">
                    <svg
                      class="w-4 h-4 mr-1 text-yellow-500"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                    Thêm hiệu ứng viền tối xung quanh ảnh
                  </p>
                </div>


<div>
    <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
        <label class="block text-sm font-medium mb-2 text-gray-800">Tách nền tự động</label>
        <button id="removeBgBtn" class="btn-primary w-full py-2 rounded-lg flex items-center justify-center">
            <span id="removeBgBtnText">Tách nền</span>
            <svg id="removeBgSpinner" class="w-5 h-5 ml-2 text-white animate-spin hidden" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
        </button>
        <p class="text-xs text-gray-500 mt-2">Sử dụng AI để tự động tách vật thể khỏi nền ảnh.</p>
    </div>
</div>

<div id="backgroundOptions" class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-100 hidden">
    <label class="block text-sm font-medium mb-3 text-gray-800">Chọn nền mới</label>
    <div class="grid grid-cols-2 gap-3">
        <label class="background-option-label">
            <input type="radio" name="bg-option" value="original" checked>
            <div class="bg-white border-2 border-transparent hover:border-gray-300 rounded-lg p-2 text-center text-sm transition-all shadow-sm">
                <p>Nền gốc</p>
                <div class="h-10 w-full rounded-md mt-1 border border-gray-200" style="background-color: #f0f0f0; background-image: repeating-linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc), repeating-linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%, #ccc); background-size: 10px 10px; background-position: 0 0, 5px 5px;"></div>
            </div>
        </label>
        <label class="background-option-label">
            <input type="radio" name="bg-option" value="white-bg">
            <div class="bg-white border-2 border-transparent hover:border-gray-300 rounded-lg p-2 text-center text-sm transition-all shadow-sm">
                <p>Nền trắng</p>
                <div class="h-10 w-full rounded-md mt-1 bg-white border border-gray-200"></div>
            </div>
        </label>
        <label class="background-option-label">
            <input type="radio" name="bg-option" value="black-bg">
            <div class="bg-white border-2 border-transparent hover:border-gray-300 rounded-lg p-2 text-center text-sm transition-all shadow-sm">
                <p>Nền đen</p>
                <div class="h-10 w-full rounded-md mt-1 bg-black"></div>
            </div>
        </label>
        <label class="background-option-label">
            <input type="radio" name="bg-option" value="color-bg">
            <div class="bg-white border-2 border-transparent hover:border-gray-300 rounded-lg p-2 text-center text-sm transition-all shadow-sm">
                <p>Nền màu</p>
                <div class="h-10 w-full rounded-md mt-1 bg-gradient-to-br from-red-500 via-yellow-500 to-green-500"></div>
            </div>
        </label>
    </div>
</div>


                <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
                  <label class="block text-sm font-medium mb-3 text-gray-800"
                    >Kiểu khung</label
                  >
                  <div class="grid grid-cols-2 gap-3">
                    <button
                      class="frame-type-btn bg-white hover:bg-gray-50 py-3 px-3 rounded-lg text-sm flex items-center justify-center active shadow-sm"
                      data-frame="film"
                    >
                      <svg
                        class="w-5 h-5 mr-2 text-gray-700"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <rect
                          x="3"
                          y="5"
                          width="18"
                          height="14"
                          rx="1"
                          stroke-width="2"
                        />
                        <line x1="3" y1="8" x2="21" y2="8" stroke-width="2" />
                        <line x1="3" y1="16" x2="21" y2="16" stroke-width="2" />
                      </svg>
                      Film
                    </button>
                    <button
                      class="frame-type-btn bg-white hover:bg-gray-50 py-3 px-3 rounded-lg text-sm flex items-center justify-center shadow-sm"
                      data-frame="polaroid"
                    >
                      <svg
                        class="w-5 h-5 mr-2 text-gray-700"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <rect
                          x="3"
                          y="3"
                          width="18"
                          height="18"
                          rx="1"
                          stroke-width="2"
                        />
                        <rect
                          x="5"
                          y="5"
                          width="14"
                          height="10"
                          stroke-width="2"
                        />
                        <line x1="8" y1="18" x2="16" y2="18" stroke-width="2" />
                      </svg>
                      Polaroid
                    </button>
                    <button
                      class="frame-type-btn bg-white hover:bg-gray-50 py-3 px-3 rounded-lg text-sm flex items-center justify-center shadow-sm"
                      data-frame="border"
                    >
                      <svg
                        class="w-5 h-5 mr-2 text-gray-700"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <rect
                          x="4"
                          y="4"
                          width="16"
                          height="16"
                          rx="1"
                          stroke-width="2"
                        />
                      </svg>
                      Viền
                    </button>
                    <button
                      class="frame-type-btn bg-white hover:bg-gray-50 py-3 px-3 rounded-lg text-sm flex items-center justify-center shadow-sm"
                      data-frame="none"
                    >
                      <svg
                        class="w-5 h-5 mr-2 text-gray-700"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <rect
                          x="5"
                          y="5"
                          width="14"
                          height="14"
                          stroke-width="2"
                        />
                        <line x1="3" y1="21" x2="7" y2="17" stroke-width="2" />
                        <line x1="21" y1="3" x2="17" y2="7" stroke-width="2" />
                        <line x1="3" y1="3" x2="7" y2="7" stroke-width="2" />
                        <line x1="21" y1="21" x2="17" y2="17" stroke-width="2" />
                      </svg>
                      Không viền
                    </button>
                  </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
                  <label class="block text-sm font-medium mb-3 text-gray-800"
                    >Màu khung</label
                  >
                  <div class="grid grid-cols-2 gap-3">
                    <button
                      class="frame-color-btn bg-white border border-gray-200 py-3 px-3 rounded-lg text-sm flex items-center justify-center active shadow-sm"
                      data-color="white"
                    >
                      <span
                        class="w-4 h-4 bg-white border border-gray-300 rounded-full mr-2"
                      ></span>
                      Trắng
                    </button>
                    <button
                      class="frame-color-btn bg-black text-white py-3 px-3 rounded-lg text-sm flex items-center justify-center shadow-sm"
                      data-color="black"
                    >
                      <span
                        class="w-4 h-4 bg-black border border-gray-300 rounded-full mr-2"
                      ></span>
                      Đen
                    </button>
                    <button
                      class="frame-color-btn bg-yellow-600 text-white py-3 px-3 rounded-lg text-sm flex items-center justify-center shadow-sm"
                      data-color="gold"
                    >
                      <span
                        class="w-4 h-4 bg-yellow-600 border border-gray-300 rounded-full mr-2"
                      ></span>
                      Vàng gold
                    </button>
                    <button
                      class="frame-color-btn bg-yellow-100 py-3 px-3 rounded-lg text-sm flex items-center justify-center shadow-sm"
                      data-color="vintage"
                    >
                      <span
                        class="w-4 h-4 bg-yellow-100 border border-gray-300 rounded-full mr-2"
                      ></span>
                      Vintage
                    </button>
                  </div>
                </div>

                <div class="custom-checkbox">
                  <input type="checkbox" id="showDateCheckbox" checked />
                  <div>
                    <label for="showDateCheckbox" class="text-sm font-medium"
                      >Hiển thị ngày tháng</label
                    >
                    <p class="text-xs text-gray-500">
                      Thêm ngày tháng vào góc ảnh
                    </p>
                  </div>
                </div>

                <div class="custom-checkbox">
                  <input type="checkbox" id="showBrandCheckbox" checked />
                  <div>
                    <label for="showBrandCheckbox" class="text-sm font-medium"
                      >Hiển thị nhãn Fujifilm</label
                    >
                    <p class="text-xs text-gray-500">
                      Thêm logo Fujifilm vào góc ảnh
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div
              id="textTab"
              class="tab-content py-4 custom-scrollbar"
              style="max-height: 70vh; overflow-y: auto"
            >
              <div class="mb-4">
        <div class="custom-checkbox select-all">
            <input type="checkbox" id="selectAllText" />
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <label for="selectAllText" class="text-sm font-medium text-green-800">Áp dụng cho tất cả khung hình</label>
            </div>
        </div>
    </div>
              <div class="space-y-5">
                <div>
                  <label class="block text-sm font-medium mb-2 text-gray-800"
                    >Chú thích</label
                  >
                  <textarea
                    id="captionText"
                    class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:border-red-500 focus:ring focus:ring-red-200 focus:ring-opacity-50"
                    rows="2"
                    placeholder="Nhập chú thích..."
                  ></textarea>
                </div>

                <div>
                  <label class="block text-sm font-medium mb-2 text-gray-800"
                    >Phông chữ</label
                  >
                  <div class="custom-select w-full">
                    <select
                      id="fontSelector"
                      class="w-full border border-gray-300 rounded-lg p-3 text-sm bg-white"
                    >
                      <option
                        value="'Courier Prime', monospace"
                        style="font-family: 'Courier Prime', monospace"
                      >
                        Courier Prime
                      </option>
                      <option
                        value="'Playfair Display', serif"
                        style="font-family: 'Playfair Display', serif"
                      >
                        Playfair Display
                      </option>
                      <option
                        value="'Poppins', sans-serif"
                        style="font-family: 'Poppins', sans-serif"
                      >
                        Poppins
                      </option>
                      <option
                        value="'Permanent Marker', cursive"
                        style="font-family: 'Permanent Marker', cursive"
                      >
                        Permanent Marker
                      </option>
                    </select>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-medium mb-2 text-gray-800"
                    >Màu chữ</label
                  >
                  <div class="grid grid-cols-6 gap-3">
                    <button
                      class="text-color-btn w-10 h-10 rounded-full bg-white border border-gray-300 active"
                      data-color="white"
                    ></button>
                    <button
                      class="text-color-btn w-10 h-10 rounded-full bg-black"
                      data-color="black"
                    ></button>
                    <button
                      class="text-color-btn w-10 h-10 rounded-full bg-red-600"
                      data-color="red"
                    ></button>
                    <button
                      class="text-color-btn w-10 h-10 rounded-full bg-blue-600"
                      data-color="blue"
                    ></button>
                    <button
                      class="text-color-btn w-10 h-10 rounded-full bg-yellow-500"
                      data-color="yellow"
                    ></button>
                    <button
                      class="text-color-btn w-10 h-10 rounded-full bg-green-600"
                      data-color="green"
                    ></button>
                  </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
                  <label class="block text-sm font-medium mb-2 text-gray-800"
                    >Vị trí</label
                  >
                  <div class="grid grid-cols-3 gap-3">
                    <button
                      class="text-position-btn bg-white hover:bg-gray-50 py-2 px-3 rounded-lg text-sm flex items-center justify-center shadow-sm"
                      data-position="top"
                    >
                      <svg
                        class="w-4 h-4 mr-1 text-gray-700"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
                        ></path>
                      </svg>
                      Trên
                    </button>
                    <button
                      class="text-position-btn bg-white hover:bg-gray-50 py-2 px-3 rounded-lg text-sm flex items-center justify-center shadow-sm"
                      data-position="middle"
                    >
                      <svg
                        class="w-4 h-4 mr-1 text-gray-700"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M4 6h16M4 12h16M4 18h7"
                        ></path>
                      </svg>
                      Giữa
                    </button>
                    <button
                      class="text-position-btn bg-white hover:bg-gray-50 py-2 px-3 rounded-lg text-sm flex items-center justify-center active shadow-sm"
                      data-position="bottom"
                    >
                      <svg
                        class="w-4 h-4 mr-1"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M4 6h16M4 12h16m-7 6h7"
                        ></path>
                      </svg>
                      Dưới
                    </button>
                  </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
                  <label class="block text-sm font-medium mb-2 text-gray-800"
                    >Kích thước</label
                  >
                  <div class="grid grid-cols-3 gap-3">
                    <button
                      class="text-size-btn bg-white hover:bg-gray-50 py-2 px-3 rounded-lg text-sm flex items-center justify-center shadow-sm"
                      data-size="small"
                    >
                      <svg
                        class="w-3 h-3 mr-1 text-gray-700"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M4 6h16M4 12h16M4 18h16"
                        ></path>
                      </svg>
                      Nhỏ
                    </button>
                    <button
                      class="text-size-btn bg-white hover:bg-gray-50 py-2 px-3 rounded-lg text-sm flex items-center justify-center active shadow-sm"
                      data-size="medium"
                    >
                      <svg
                        class="w-4 h-4 mr-1"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M4 6h16M4 12h16M4 18h16"
                        ></path>
                      </svg>
                      Vừa
                    </button>
                    <button
                      class="text-size-btn bg-white hover:bg-gray-50 py-2 px-3 rounded-lg text-sm flex items-center justify-center shadow-sm"
                      data-size="large"
                    >
                      <svg
                        class="w-5 h-5 mr-1 text-gray-700"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M4 6h16M4 12h16M4 18h16"
                        ></path>
                      </svg>
                      Lớn
                    </button>
                  </div>
                </div>

                <div
                  class="text-preview p-4 border border-gray-200 rounded-lg bg-gray-50 mb-4"
                >
                  <p class="text-sm text-gray-500 mb-2 flex items-center">
                    <svg
                      class="w-4 h-4 mr-1 text-yellow-500"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                      ></path>
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                      ></path>
                    </svg>
                    Xem trước:
                  </p>
                  <div
                    id="textPreview"
                    class="bg-black p-3 rounded-lg flex items-center justify-center"
                    style="min-height: 70px"
                  >
                    <span
                      class="text-white font-medium"
                      style="font-family: 'Courier Prime', monospace"
                      >Tandev.foto Studio</span
                    >
                  </div>
                </div>

                <button
                  id="applyTextBtn"
                  class="btn-primary w-full py-3 rounded-lg"
                >
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M5 13l4 4L19 7"
                    ></path>
                  </svg>
                  Áp dụng chữ
                </button>
              </div>
            </div>

            <div
              id="stickersTab"
              class="tab-content py-4 custom-scrollbar"
              style="max-height: 70vh; overflow-y: auto"
            >
                <div class="mb-4">
        <div class="custom-checkbox select-all">
            <input type="checkbox" id="selectAllStickers" />
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <label for="selectAllStickers" class="text-sm font-medium text-green-800">Áp dụng cho tất cả khung hình</label>
            </div>
        </div>
    </div>
              <div class="flex justify-between items-center mb-4">
                <h3 class="font-medium flex items-center text-gray-800">
                  <svg
                    class="w-5 h-5 mr-2 text-red-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
                    ></path>
                  </svg>
                  Stickers
                  <span class="badge ml-2">20</span>
                </h3>
                <p
                  class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full"
                >
                  Nhấp để thêm
                </p>
              </div>
              <div class="grid grid-cols-3 gap-4">
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="heart"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="#ff4d6d"
                    width="36"
                    height="36"
                  >
                    <path
                      d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                    />
                  </svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="star"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="#ffd700"
                    width="36"
                    height="36"
                  >
                    <path
                      d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                    />
                  </svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="smile"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="#ffcc00"
                    width="36"
                    height="36"
                  >
                    <circle cx="12" cy="12" r="10" fill="#ffcc00" />
                    <path
                      d="M8 14s1.5 2 4 2 4-2 4-2"
                      stroke="#000"
                      stroke-width="1"
                      fill="none"
                    />
                    <circle cx="9" cy="9" r="1.5" fill="#000" />
                    <circle cx="15" cy="9" r="1.5" fill="#000" />
                  </svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="camera"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="#333"
                    width="36"
                    height="36"
                  >
                    <path
                      d="M9 3L7.17 5H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2h-3.17L15 3H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"
                    />
                    <circle cx="12" cy="13" r="3" />
                  </svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="location"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="#ff4d4d"
                    width="36"
                    height="36"
                  >
                    <path
                      d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"
                    />
                  </svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="like"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="#3b82f6"
                    width="36"
                    height="36"
                  >
                    <path
                      d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-1.91l-.01-.01L23 10z"
                    />
                  </svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="fire"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="#ff7700"
                    width="36"
                    height="36"
                  >
                    <path
                      d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"
                    />
                  </svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="music"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="#9333ea"
                    width="36"
                    height="36"
                  >
                    <path
                      d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"
                    />
                  </svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="sun"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="#fbbf24"
                    width="36"
                    height="36"
                  >
                    <path
                      d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"
                    />
                  </svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="sparkles"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#a855f7"><path d="M11 2a1 1 0 0 1 2 0v5h5a1 1 0 0 1 0 2h-5v5a1 1 0 0 1-2 0v-5H4a1 1 0 0 1 0-2h5V2zm10 13a1 1 0 0 1-2 0v-2a1 1 0 0 1 2 0v2zm-2-6a1 1 0 0 1 0 2h-2a1 1 0 0 1 0-2h2zm-2 6a1 1 0 0 1 0 2h-2a1 1 0 0 1 0-2h2zm-4 4a1 1 0 0 1 0 2h-2a1 1 0 0 1 0-2h2zm-4-4a1 1 0 0 1 0 2H9a1 1 0 0 1 0-2h2zm-2-4a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2h2zM3 13a1 1 0 0 1 2 0v2a1 1 0 0 1-2 0v-2zM3 9a1 1 0 0 1 2 0v2a1 1 0 0 1-2 0V9zM7 5a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2h2z"></path></svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="cloud-lightning"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#60a5fa"><path d="M19.34 8c-1.55-3.32-5.18-5.32-8.5-4.5-3.23.8-5.46 4.14-4.5 7.42-.51 1.09-.84 2.3-.92 3.58-.09 1.1.28 2.2.97 3.03.68.83 1.63 1.3 2.62 1.34h9.11c2.14.28 3.99-1.39 4.27-3.53.28-2.14-1.39-3.99-3.53-4.27zM11 12l-4 7h6l-3-6h3l-3-5z"></path></svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="coffee"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#9333ea"><path d="M18.5 12a2.5 2.5 0 0 0 0-5H18V4H6v3h.5a2.5 2.5 0 0 0 0 5H6v9h12v-9h.5zM16 19H8v-7h8v7zm-.5-5a.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5h-2z"></path></svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="peace"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#a78bfa"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zM12 5l-7 7.01h14L12 5zm-7 8l-3 3.01H22l-3-3.01H5z"></path></svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="ghost"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#e2e8f0"><path d="M12 2C6.48 2 2 6.48 2 12c0 3.86 2.05 7.23 5.12 9.07l.88-1.53c-2.31-1.32-3.9-3.96-3.9-6.54 0-4.41 3.59-8 8-8s8 3.59 8 8c0 2.58-1.59 5.22-3.9 6.54l.88 1.53C20.95 19.23 23 15.86 23 12c0-5.52-4.48-10-10-10zm-4 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>
                </div>
                <div
                  class="sticker-item bg-white p-3 rounded-lg cursor-pointer hover:bg-gray-50 flex items-center justify-center shadow-sm"
                  data-sticker="cool"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#0ea5e9"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14c-1.92 0-3.64-1.11-4.47-2.71l-.1-.2-.1-.21c-.81-1.61-.83-3.52-.06-5.11l.24-.5.17-.3c.75-1.37 2.06-2.28 3.51-2.28h.01c.2 0 .4.02.59.07l.1.02.21.05c1.61.35 2.87 1.8 2.87 3.5H12c0 1.93-1.57 3.5-3.5 3.5zm7-4h-2c-1.1 0-2 .9-2 2s.9 2 2 2h2v1H8v-1c-1.66 0-3-1.34-3-3s1.34-3 3-3h7c1.66 0 3 1.34 3 3s-1.34 3-3 3z"></path></svg>
                </div>

              </div>

              <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-100">
                <h4
                  class="text-sm font-medium mb-2 text-blue-800 flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-1 text-blue-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                  Hướng dẫn sử dụng sticker:
                </h4>
                <ul class="text-xs text-blue-700 space-y-2 list-disc pl-5">
                  <li>Nhấp vào sticker để thêm vào ảnh</li>
                  <li>Kéo để di chuyển sticker đến vị trí mong muốn</li>
                  <li>Sử dụng thanh kéo ở góc dưới bên phải để thay đổi kích thước</li>
                  <li>Nhấp vào nút X để xóa sticker</li>
                </ul>
              </div>
            </div>


          </div>
        </div>
      </main>

  <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden modal">
      <div class="bg-white rounded-xl w-full max-w-lg overflow-hidden modal-content">
          <div class="p-4 border-b border-gray-200 flex justify-between items-center modal-header">
              <h3 class="font-medium text-lg flex items-center">
                  <svg class="w-5 h-5 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                  </svg>
                  Chia sẻ bộ sưu tập
              </h3>
              <button id="closeShareModal" class="text-gray-500 hover:text-gray-700 transition-colors">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
              </button>
          </div>
          <div class="p-6 text-center">
              <div id="shareLoading" class="hidden flex flex-col items-center justify-center py-10">
                  <div class="loading-spinner w-8 h-8 border-4"></div>
                  <p class="text-gray-500 mt-4 text-sm">Đang tạo ảnh để chia sẻ...</p>
              </div>
              
              <div id="shareContent" class="space-y-6">
                  <div>
                      <h4 class="text-sm font-medium mb-3">Quét mã QR để tải về</h4>
                      <div id="qrcode" class="w-48 h-48 mx-auto p-2 bg-white rounded-lg shadow-inner"></div>
                      <p class="text-xs text-gray-500 mt-2">Mã QR này sẽ hết hạn sau 15 phút.</p>
                  </div>

                  <div class="border-t border-gray-200 pt-6">
                      <h4 class="text-sm font-medium mb-3">Hoặc chia sẻ trực tiếp</h4>
                      <div class="flex justify-center gap-4">
                          <a id="shareFacebook" href="#" target="_blank" class="w-12 h-12 flex items-center justify-center rounded-full bg-blue-600 hover:bg-blue-700 text-white transition-colors" title="Chia sẻ lên Facebook">
                              <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.039c-5.46 0-9.92 4.417-9.92 9.875 0 5.097 3.923 9.317 9.014 9.866v-6.938h-2.529v-2.928h2.529V9.61c0-2.502 1.493-3.87 3.766-3.87 1.082 0 2.203.193 2.203.193V8.89h-1.28c-1.258 0-1.64.782-1.64 1.579v1.86h2.868l-.458 2.928h-2.41V21.78c5.09-0.549 9.014-4.769 9.014-9.866 0-5.458-4.46-9.875-9.92-9.875z"></path></svg>
                          </a>
                          <a id="shareZalo" href="#" target="_blank" class="w-12 h-12 flex items-center justify-center rounded-full bg-blue-500 hover:bg-blue-600 text-white transition-colors" title="Chia sẻ qua Zalo">
                              <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M21 2c-3.116-.275-5.992 1.348-7.79 4.25-1.127 1.83-1.624 3.99-1.517 6.136.19 3.715 2.115 6.775 5.56 8.35.918.423 1.93.684 2.936.782.164.016.326-.008.487-.075.148-.063.29-.153.418-.266 1.096-.99 1.81-2.455 2.15-4.148.337-1.74-.216-3.41-1.397-4.667-1.182-1.257-2.91-1.84-4.66-1.52-2.146.4-3.79 2.05-4.363 4.21-.497 1.918.06 3.97 1.638 5.308l.006.004c.148.125.32.22.508.28.188.062.385.088.583.076.62-.038 1.19-.247 1.688-.585.127-.087.243-.19.347-.312l.02-.023c.315-.365.656-.707.965-1.07.288-.344.52-.73.687-1.144.156-.39.262-.806.29-1.228.026-.41.002-.82-.07-1.22l-.125-.66-.02-.132c.16-.94-.07-1.88-.69-2.6-.62-.72-1.516-1.066-2.484-.963-1.407.147-2.392 1.353-2.69 2.768-.298 1.415-.098 2.89.58 4.195.03.057.065.11.104.16.14.168.286.324.44.468.16.155.33.29.507.416.3.21.61.393.93.553.14.07.28.126.42.17.155.047.31.07.46.07.66 0 1.25-.26 1.69-.73.69-.7.98-1.72.84-2.73-.1-1.01-.5-1.92-1.12-2.61-1.35-1.5-3.3-2.22-5.06-2.16-1.31.04-2.58.46-3.64 1.21-.19-.48-.28-.99-.28-1.5 0-3.37 2.1-5.91 5.37-6.24.46-.05.9-.06 1.35-.06 4.36 0 7.82 3.1 7.82 7.21 0 .23-.01.46-.02.69.04.1.08.19.12.28 1.09 2.17.47 4.7-1.33 6.36l-.01.01zm-15.65 6.03l-.004.004c-.11.12-.224.23-.34.33-.08.07-.16.13-.242.18-.172.1-.35.18-.53.25-.21.08-.41.13-.62.16-.13.01-.27.01-.4 0-.17-.01-.33-.04-.5-.09-.27-.08-.53-.18-.77-.3-1.3-.6-2.3-1.63-2.98-2.91-.7-1.32-1.01-2.73-1.01-4.21 0-2.82.99-5.18 3.01-6.73.54-.42 1.15-.76 1.8-.99.53-.19 1.09-.29 1.65-.29 2.71 0 5.16 1.5 6.4 3.9-.19.46-.42.9-.69 1.3-1.42 2.1-3.64 3.4-6.07 3.51-.8.04-1.59-.06-2.35-.29-.2-.06-.4-.14-.59-.22-.19-.09-.38-.19-.55-.32-1.2-1.1-1.8-2.62-1.73-4.22.07-1.59.83-3.08 2.24-4.14 1.42-1.06 3.1-1.59 4.8-1.53 1.34.05 2.65.5 3.73 1.27.42.3.77.67 1.06 1.1.28.43.48.92.6 1.42.1.4.16.82.16 1.25 0 2.2-.95 4.14-2.45 5.51-1.46 1.31-3.34 1.95-5.32 1.87-1.25-.05-2.47-.41-3.53-1.06-.11.08-.22.15-.34.23z"></path></svg>
                          </a>
                          <a id="shareEmail" href="#" class="w-12 h-12 flex items-center justify-center rounded-full bg-red-500 hover:bg-red-600 text-white transition-colors" title="Chia sẻ qua Email">
                              <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"></path></svg>
                          </a>
                          <button id="copyLinkBtn" class="w-12 h-12 flex items-center justify-center rounded-full bg-gray-400 hover:bg-gray-500 text-white transition-colors" title="Sao chép đường link">
                              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.131a4 4 0 000-5.656l-4-4a4 4 0 00-5.656 0l-1.1 1.1"></path></svg>
                          </button>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>



      <footer
        class="bg-gradient-to-r from-gray-800 to-black text-white py-6 px-6 mt-8"
      >
        <div class="container mx-auto">
          <div class="flex flex-col md:flex-row justify-between items-center">
            <div class="mb-4 md:mb-0">
              <div class="flex items-center mb-2">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  class="mr-2"
                >
                  <rect width="24" height="24" rx="6" fill="#FF0000" />
                  <path d="M4 7H20V17H4V7Z" fill="white" />
                  <path d="M6 9H18V15H6V9Z" fill="#FF0000" />
                  <path d="M8 11H16V13H8V11Z" fill="white" />
                </svg>
                <p class="text-sm font-medium">
                  &copy; 2023 Tandev.foto Studio. Tất cả quyền được bảo lưu.
                </p>
              </div>
              <p class="text-xs text-gray-400 footer-mobile-hidden">
                Công cụ chỉnh sửa ảnh phong cách film Fujifilm
              </p>
            </div>
            <div class="flex gap-6 footer-mobile-hidden">
              <a
                href="#"
                class="text-gray-300 hover:text-white text-sm flex items-center"
              >
                <svg
                  class="w-4 h-4 mr-1"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
                Về chúng tôi
              </a>
              <a
                href="#"
                class="text-gray-300 hover:text-white text-sm flex items-center"
              >
                <svg
                  class="w-4 h-4 mr-1"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                  ></path>
                </svg>
                Hướng dẫn
              </a>
              <a
                href="#"
                class="text-gray-300 hover:text-white text-sm flex items-center"
              >
                <svg
                  class="w-4 h-4 mr-1"
                  fill="none"
                  stroke="currentColor"
                  viewbox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  ></path>
                </svg>
                Liên hệ
              </a>
            </div>
          </div>
        </div>
      </footer>

<div id="cameraModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50">
    <div class="w-full max-w-lg overflow-hidden bg-white rounded-lg shadow-xl">

        <div class="flex items-center justify-between p-4 border-b">
            <h3 class="flex items-center text-lg font-semibold">
                <svg class="w-6 h-6 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                Chụp ảnh
            </h3>
            <button id="closeCamera" class="text-gray-500 transition-colors hover:text-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>

        <div class="relative p-4">
            <video id="cameraVideo" class="w-full bg-black rounded-md" autoplay playsinline></video>
            
            <div id="flash" class="absolute inset-0 z-10 bg-white opacity-0 pointer-events-none"></div>
            <span id="cameraCountdown" class="absolute top-1/2 left-1/2 z-20 hidden -translate-x-1/2 -translate-y-1/2 text-6xl font-bold text-white">3</span>
            <span id="photoboothCountdown" class="absolute top-1/2 left-1/2 z-20 hidden -translate-x-1/2 -translate-y-1/2 text-6xl font-bold text-white">3</span>
            <div id="recIndicator" class="absolute top-6 left-6 hidden items-center rounded-full bg-black bg-opacity-50 px-2 py-1 text-xs text-white">
                <span class="w-2 h-2 mr-2 bg-red-500 rounded-full animate-pulse"></span>REC
            </div>
            <div id="fujifilmLogo" class="absolute hidden px-2 py-1 text-xs text-gray-600 bg-gray-200 rounded-md top-6 right-6">FUJIFILM</div>
        </div>

        <div class="flex justify-around p-4 bg-gray-50">
            <button id="switchCameraBtn" class="px-4 py-2 font-bold text-white bg-blue-500 rounded hover:bg-blue-700 focus:outline-none">
                Đổi camera
            </button>
            <button id="takePhotoBtn" class="px-4 py-2 font-bold text-white bg-green-500 rounded hover:bg-green-700 focus:outline-none">
                Chụp ảnh
            </button>
            <button id="takePhotoboothBtn" class="px-4 py-2 font-bold text-white bg-purple-500 rounded hover:bg-purple-700 focus:outline-none">
                Chụp Photobooth
            </button>
        </div>
    </div>
</div>
      
<script>
  document.addEventListener("DOMContentLoaded", () => {
    /* --- Nâng cấp Dark Mode / Light Mode Toggle Script --- */
    const themeToggleBtn = document.getElementById('theme-toggle');

    function applyTheme(theme) {
        const isDark = theme === 'dark';
        document.body.classList.toggle('dark', isDark);
        themeToggleBtn.classList.toggle('loading', true);
        setTimeout(() => {
            themeToggleBtn.classList.toggle('loading', false);
            const newText = isDark ? "Đã chuyển sang Chế độ tối." : "Đã chuyển sang Chế độ sáng.";
            showNotification(newText, false);
        }, 400);
    }

    const currentTheme = localStorage.getItem('theme');
    if (currentTheme) {
        applyTheme(currentTheme);
    }

    themeToggleBtn.addEventListener('click', () => {
        const currentMode = document.body.classList.contains('dark') ? 'light' : 'dark';
        applyTheme(currentMode);
        localStorage.setItem('theme', currentMode);
    });

    // --- Biến toàn cục và Element cache ---
    let currentActiveFrameId = "frame-1";
    const galleryContainer = document.getElementById("galleryContainer");
    const cameraVideo = document.getElementById("cameraVideo");
    const cameraModal = document.getElementById("cameraModal");
    const cameraCountdown = document.getElementById("cameraCountdown");
    const photoboothCountdown = document.getElementById("photoboothCountdown");
    const closeCamera = document.getElementById("closeCamera");
    let videoStream;
    let currentFacingMode = "user";
    let isEditingAllFrames = false;

    const flashEffectDiv = document.getElementById("flash");
    const notificationDiv = document.getElementById("notification");
    const notificationMessageSpan = notificationDiv.querySelector("span");

    const allFramesCheckboxes = {
        filters: document.getElementById('selectAllFrames'),
        effects: document.getElementById('selectAllEffects')
    };
    const allFramesCheckboxContainers = {
        filters: allFramesCheckboxes.filters.closest('.custom-checkbox'),
        effects: allFramesCheckboxes.effects.closest('.custom-checkbox')
    };

    // Biến và elements cho chức năng tách nền
    const REMOVE_BG_API_KEY = "yCBhn44BZg4aGEC3quegGbe1"; // Thay bằng API Key của bạn
    const removeBgBtn = document.getElementById("removeBgBtn");
    const removeBgBtnText = document.getElementById("removeBgBtnText");
    const removeBgSpinner = document.getElementById("removeBgSpinner");
    const backgroundOptionsDiv = document.getElementById("backgroundOptions");
    const backgroundOptionInputs = document.querySelectorAll('#backgroundOptions input[name="bg-option"]');
    
    let originalImageSrc = null;
    let currentRemovedBgImageSrc = null;

    // --- Helper Functions ---
    function showNotification(message = "Thao tác thành công!", isError = false) {
        notificationMessageSpan.textContent = message;
        notificationDiv.style.backgroundColor = isError ? "#dc3545" : "#333";
        notificationDiv.classList.add("show");
        setTimeout(() => {
            notificationDiv.classList.remove("show");
        }, 3000);
    }

    function triggerFlash() {
        flashEffectDiv.classList.add("flash-animation");
        flashEffectDiv.addEventListener("animationend", () => {
            flashEffectDiv.classList.remove("flash-animation");
        }, { once: true });
    }

    // --- Quản lý Active Frame (Khung ảnh đang chỉnh sửa) ---
    function getTargetFrames() {
        if (isEditingAllFrames) {
            const frames = Array.from(document.querySelectorAll('.film-frame')).filter(frame => frame.querySelector('img'));
            if (frames.length === 0) {
                showNotification("Không có ảnh nào để chỉnh sửa.", true);
            }
            return frames;
        } else {
            const activeFrame = document.getElementById(currentActiveFrameId);
            return activeFrame && activeFrame.querySelector('img') ? [activeFrame] : [];
        }
    }

    function setActiveFrame(frameId) {
        document.querySelectorAll(".film-frame").forEach(frame => {
            frame.classList.remove("active-edit-frame");
            frame.classList.remove("selected-all");
        });
        const newActiveFrame = document.getElementById(frameId);
        if (newActiveFrame) {
            newActiveFrame.classList.add("active-edit-frame");
            currentActiveFrameId = frameId;
        } else {
            currentActiveFrameId = null;
        }
    }
    
    // Cập nhật lại khung "Nhấp để thêm ảnh" ban đầu
    function createPlaceholderFrame(id) {
        const newFrame = document.createElement("div");
        newFrame.className = "film-frame";
        newFrame.id = id;
        newFrame.innerHTML = `
            <div class="film-strip">
                <div class="film-hole"></div><div class="film-hole"></div><div class="film-hole"></div><div class="film-hole"></div>
            </div>
            <div class="image-placeholder">
                <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                <span class="image-placeholder-text">Nhấp để thêm ảnh</span>
            </div>
            <div class="film-strip">
                <div class="film-hole"></div><div class="film-hole"></div><div class="film-hole"></div><div class="film-hole"></div>
            </div>
        `;
        const placeholder = newFrame.querySelector(".image-placeholder");
        setupPlaceholder(placeholder);
        setupImageActions(newFrame);
        return newFrame;
    }

    // Tạo 4 khung ảnh placeholder mặc định
    function createDefaultPlaceholders() {
        galleryContainer.innerHTML = '';
        for (let i = 0; i < 4; i++) {
            const frameId = `frame-${i}`;
            galleryContainer.appendChild(createPlaceholderFrame(frameId));
        }
        // Đặt khung thứ 2 làm khung active mặc định như trong code ban đầu
        setActiveFrame('frame-1');
    }


    // --- Chức năng tải ảnh cho Placeholder ---
    function setupPlaceholder(placeholder) {
        placeholder.addEventListener("click", (event) => {
            const input = document.createElement("input");
            input.type = "file";
            input.accept = "image/*";
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const parentFrame = placeholder.closest(".film-frame");
                        if (parentFrame) {
                            const imageContainer = document.createElement("div");
                            imageContainer.className = "image-container";
                            imageContainer.innerHTML = `
                                <img src="${event.target.result}" alt="User image" class="edited-image">
                                <div class="film-date">${new Date().toISOString().slice(0, 10)}</div>
                                <div class="film-brand">FUJIFILM</div>
                                <div class="image-actions">
                                    <button class="action-btn edit-btn" title="Chỉnh sửa">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                        </svg>
                                    </button>
                                    <button class="action-btn delete-btn" title="Xóa">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            `;
                            placeholder.replaceWith(imageContainer);
                            setupImageActions(imageContainer.closest('.film-frame'));
                            showNotification("Đã tải ảnh lên thành công!");
                            setActiveFrame(parentFrame.id);
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        });
    }

    // --- Xử lý sự kiện cho các nút hành động trên ảnh ---
    function setupImageActions(frame) {
        const deleteBtn = frame.querySelector(".delete-btn");
        if (deleteBtn) {
            deleteBtn.addEventListener("click", handleDeleteButtonClick);
        }
        const editBtn = frame.querySelector(".edit-btn");
        if (editBtn) {
            editBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                setActiveFrame(frame.id);
                showNotification(`Đang chỉnh sửa khung: ${frame.id}`);
            });
        }
        frame.addEventListener("click", (e) => {
            if (!isEditingAllFrames) {
                setActiveFrame(frame.id);
            }
        });
    }

    document.querySelectorAll(".image-placeholder").forEach(setupPlaceholder);
    document.querySelectorAll(".film-frame").forEach(setupImageActions);


    // --- Chức năng Xóa Khung Ảnh ---
    function handleDeleteButtonClick(event) {
        event.stopPropagation();
        if (confirm("Bạn có chắc chắn muốn xóa khung ảnh này không?")) {
            const frameToRemove = event.currentTarget.closest(".film-frame");
            if (frameToRemove) {
                const nextFrame = frameToRemove.nextElementSibling || galleryContainer.firstElementChild;
                frameToRemove.remove();
                showNotification("Đã xóa khung ảnh!");
                if (frameToRemove.id === currentActiveFrameId) {
                    currentActiveFrameId = null;
                    if (nextFrame) {
                        setActiveFrame(nextFrame.id);
                    }
                }
            }
        }
    }

    // --- Chức năng Thêm Khung Mới ---
    document.getElementById("addFrameBtn").addEventListener("click", () => {
        const newFrameId = `frame-${Date.now()}`;
        const newFrameHTML = `
            <div class="film-frame" id="${newFrameId}">
                <div class="film-strip">
                    <div class="film-hole"></div><div class="film-hole"></div><div class="film-hole"></div><div class="film-hole"></div>
                </div>
                <div class="image-placeholder">
                    <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span class="image-placeholder-text">Nhấp để thêm ảnh</span>
                </div>
                <div class="film-strip">
                    <div class="film-hole"></div><div class="film-hole"></div><div class="film-hole"></div><div class="film-hole"></div>
                </div>
            </div>
        `;
        galleryContainer.insertAdjacentHTML("beforeend", newFrameHTML);
        showNotification("Đã thêm khung ảnh mới!");
        const newFrame = document.getElementById(newFrameId);
        setupPlaceholder(newFrame.querySelector(".image-placeholder"));
        setupImageActions(newFrame);
        setActiveFrame(newFrameId);
    });

    // --- Chức năng Xóa Tất Cả Khung Ảnh và tạo lại 4 khung mặc định ---
    document.getElementById("clearAllBtn").addEventListener("click", () => {
        if (confirm("Bạn có chắc chắn muốn xóa tất cả các khung ảnh không?")) {
            clearAllAndAddPlaceholders();
            showNotification("Đã xóa tất cả khung ảnh và tạo lại 4 khung mặc định!");
        }
    });
    
    function clearAllAndAddPlaceholders() {
        // Xóa tất cả khung hiện tại
        galleryContainer.innerHTML = '';
        // Thêm 4 khung mặc định vào lại
        createDefaultPlaceholders();
        currentActiveFrameId = null;
    }

    // --- Chức năng Chuyển đổi Bố cục ---
    document.getElementById("layoutSelector").addEventListener("change", function() {
        const layout = this.value;
        galleryContainer.classList.remove(
            "grid", "grid-cols-2", "gap-6", "flex", "flex-col", "flex-row", "overflow-x-auto", "pb-4", "collage-layout", "filmstrip-container"
        );
        galleryContainer.style.height = "";

        document.querySelectorAll(".film-frame").forEach(frame => {
            frame.classList.remove("polaroid");
            frame.style.width = "";
            frame.style.gridColumn = "";
            frame.style.gridRow = "";
        });

        switch (layout) {
            case "grid":
                galleryContainer.classList.add("grid", "grid-cols-2", "gap-6");
                break;
            case "vertical":
                galleryContainer.classList.add("flex", "flex-col", "gap-6");
                break;
            case "horizontal":
                galleryContainer.classList.add("flex", "flex-row", "gap-6", "overflow-x-auto", "pb-4", "filmstrip-container");
                break;
            case "collage":
                galleryContainer.classList.add("collage-layout");
                galleryContainer.style.height = "600px";
                break;
            case "filmstrip":
                galleryContainer.classList.add("filmstrip-container");
                document.querySelectorAll(".film-frame").forEach(frame => frame.classList.add("filmstrip-layout"));
                break;
            case "polaroid":
                galleryContainer.classList.add("grid", "grid-cols-2", "gap-6");
                document.querySelectorAll(".film-frame").forEach(frame => frame.classList.add("polaroid"));
                break;
        }
        showNotification(`Đã đổi bố cục sang ${layout}!`);
    });

    // --- Chức năng Áp dụng Bộ lọc (Filters) ---
    const filters = {
        none: "",
        provia: "contrast(1.15) brightness(1) saturate(1.1)",
        velvia: "contrast(1.3) brightness(1) saturate(1.5)",
        astia: "contrast(1) brightness(1.05) saturate(0.9)",
        "classic-chrome": "contrast(1.1) brightness(0.95) saturate(0.75) sepia(0.1)",
        acros: "contrast(1.2) brightness(1) saturate(0) sepia(0.05)",
        monochrome: "grayscale(1) contrast(1.2)",
        sepia: "sepia(0.8) contrast(1.1)",
        "pro-neg-hi": "contrast(1.1) brightness(1) saturate(0.9)",
        "pro-neg-std": "contrast(1) brightness(1) saturate(0.8)",
        eterna: "contrast(0.9) brightness(1.05) saturate(0.85)",
        classic: "contrast(1.1) brightness(1.1) saturate(1.3) sepia(0.2)",
    };

    document.querySelectorAll("#filtersTab .filter-option").forEach(filterOption => {
        filterOption.addEventListener("click", () => {
            const targetFrames = getTargetFrames();
            if (targetFrames.length === 0) {
                showNotification("Vui lòng chọn một khung ảnh hoặc tất cả khung hình để áp dụng bộ lọc.", true);
                return;
            }

            document.querySelectorAll("#filtersTab .filter-option").forEach(opt => opt.classList.remove("active"));
            filterOption.classList.add("active");

            const filterValue = filterOption.dataset.filter;
            targetFrames.forEach(frame => {
                const img = frame.querySelector(".image-container img");
                if (img) {
                    img.style.filter = filters[filterValue];
                }
            });

            showNotification(`Đã áp dụng bộ lọc ${filterValue} cho ${isEditingAllFrames ? 'tất cả' : 'khung hình đang chọn'}!`);
        });
    });

    // --- Chức năng Điều chỉnh Hiệu ứng (Effects) ---
    const grainSlider = document.getElementById("grainSlider");
    const grainValueSpan = document.getElementById("grainValue");
    const grainProgressBar = document.getElementById("grainProgress");

    const leakSlider = document.getElementById("leakSlider");
    const leakValueSpan = document.getElementById("leakValue");
    const leakProgressBar = document.getElementById("leakProgress");

    const vignetteSlider = document.getElementById("vignetteSlider");
    const vignetteValueSpan = document.getElementById("vignetteValue");
    const vignetteProgressBar = document.getElementById("vignetteProgress");

    function applyCombinedEffects() {
        const targetFrames = getTargetFrames();
        if (targetFrames.length === 0) return;

        const grain = parseFloat(grainSlider.value);
        const leak = parseFloat(leakSlider.value);
        const vignette = parseFloat(vignetteSlider.value);

        targetFrames.forEach(frame => {
            const imgContainer = frame.querySelector(".image-container");
            const img = imgContainer ? imgContainer.querySelector("img") : null;
            if (!img) return;

            ['.grain-overlay', '.leak-overlay', '.vignette-overlay'].forEach(sel => {
                const overlay = imgContainer.querySelector(sel);
                if (overlay) overlay.remove();
            });

            if (grain > 0) {
                const grainOverlay = document.createElement("div");
                grainOverlay.className = 'effect-overlay grain-overlay';
                grainOverlay.style.background = `url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/38AAwAB/9oB7QAAAABJRU5ErkJggg==) repeat`;
                grainOverlay.style.backgroundSize = '2px 2px';
                grainOverlay.style.opacity = grain / 100 * 0.4;
                imgContainer.appendChild(grainOverlay);
            }

            if (leak > 0) {
                const leakOverlay = document.createElement("div");
                leakOverlay.className = 'effect-overlay leak-overlay';
                leakOverlay.style.background = `radial-gradient(ellipse at 80% 20%, rgba(255,165,0,0.5) 0%, transparent 70%)`;
                leakOverlay.style.opacity = leak / 100;
                imgContainer.appendChild(leakOverlay);
            }

            if (vignette > 0) {
                const vignetteOverlay = document.createElement("div");
                vignetteOverlay.className = 'effect-overlay vignette-overlay';
                vignetteOverlay.style.boxShadow = `inset 0 0 ${vignette * 0.5}px ${vignette * 0.2}px rgba(0,0,0,0.8)`;
                imgContainer.appendChild(vignetteOverlay);
            }
        });
        showNotification(`Đã điều chỉnh hiệu ứng cho ${isEditingAllFrames ? 'tất cả' : 'khung hình đang chọn'}!`);
    }

    grainSlider.addEventListener("input", function() {
        grainValueSpan.textContent = this.value + "%";
        grainProgressBar.style.width = this.value + "%";
        applyCombinedEffects();
    });

    leakSlider.addEventListener("input", function() {
        leakValueSpan.textContent = this.value + "%";
        leakProgressBar.style.width = this.value + "%";
        applyCombinedEffects();
    });

    vignetteSlider.addEventListener("input", function() {
        vignetteValueSpan.textContent = this.value + "%";
        vignetteProgressBar.style.width = this.value + "%";
        applyCombinedEffects();
    });

    // --- Chức năng Tùy chỉnh Kiểu khung ---
    document.querySelectorAll(".frame-type-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            document.querySelectorAll(".frame-type-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            const frameType = btn.dataset.frame;
            document.querySelectorAll(".film-frame").forEach(frame => {
                frame.classList.remove("polaroid");
                frame.style.padding = "";
                frame.style.backgroundColor = "";

                const filmStripTop = frame.querySelector(".film-strip:first-of-type");
                const filmStripBottom = frame.querySelector(".film-strip:last-of-type");
                const imageContainer = frame.querySelector(".image-container");

                if (filmStripTop) filmStripTop.style.display = "none";
                if (filmStripBottom) filmStripBottom.style.display = "none";
                if (imageContainer) imageContainer.style.borderRadius = "4px";

                if (frameType === "film") {
                    if (filmStripTop) filmStripTop.style.display = "flex";
                    if (filmStripBottom) filmStripBottom.style.display = "flex";
                    if (imageContainer) imageContainer.style.borderRadius = "0";
                } else if (frameType === "polaroid") {
                    frame.classList.add("polaroid");
                    frame.style.paddingBottom = "40px";
                    frame.style.backgroundColor = "white";
                } else if (frameType === "border") {
                    frame.style.padding = "20px";
                    frame.style.backgroundColor = "white";
                } else if (frameType === "none") {
                    frame.style.padding = "0";
                    frame.style.backgroundColor = "white";
                }
                updateFilmDetailsVisibility();
            });
            showNotification(`Đã đổi kiểu khung thành ${frameType}!`);
        });
    });

    // --- Chức năng Tùy chỉnh Màu khung ---
    document.querySelectorAll(".frame-color-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            document.querySelectorAll(".frame-color-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            const color = btn.dataset.color;
            document.querySelectorAll(".film-frame").forEach(frame => {
                frame.style.backgroundColor = "";
                if (color === "white") {
                    frame.style.backgroundColor = "white";
                } else if (color === "black") {
                    frame.style.backgroundColor = "black";
                } else if (color === "gold") {
                    frame.style.backgroundColor = "gold";
                } else if (color === "vintage") {
                    frame.style.backgroundColor = "#F5E3D1";
                }
            });
            showNotification(`Đã đổi màu khung thành ${color}!`);
        });
    });

    // --- Chức năng Chú thích (Text) ---
    const captionTextarea = document.getElementById("captionText");
    const fontSelector = document.getElementById("fontSelector");
    const textColorBtns = document.querySelectorAll(".text-color-btn");
    const textPositionBtns = document.querySelectorAll(".text-position-btn");
    const textSizeBtns = document.querySelectorAll(".text-size-btn");
    const applyTextBtn = document.getElementById("applyTextBtn");
    const textPreviewSpan = document.getElementById("textPreview").querySelector("span");

    let currentTextSettings = {
        text: "Tandev.foto Studio",
        font: "'Courier Prime', monospace",
        color: "white",
        position: "bottom",
        size: "medium",
    };

    function updateTextPreview() {
        textPreviewSpan.textContent = captionTextarea.value || "Tandev.foto Studio";
        textPreviewSpan.style.fontFamily = fontSelector.value;
        textPreviewSpan.style.color = document.querySelector(".text-color-btn.active").dataset.color;
        let fontSize;
        switch (document.querySelector(".text-size-btn.active").dataset.size) {
            case "small":
                fontSize = "12px";
                break;
            case "medium":
                fontSize = "16px";
                break;
            case "large":
                fontSize = "20px";
                break;
            default:
                fontSize = "16px";
        }
        textPreviewSpan.style.fontSize = fontSize;
    }

    captionTextarea.addEventListener("input", () => {
        currentTextSettings.text = captionTextarea.value;
        updateTextPreview();
    });
    fontSelector.addEventListener("change", () => {
        currentTextSettings.font = fontSelector.value;
        updateTextPreview();
    });
    textColorBtns.forEach(btn => {
        btn.addEventListener("click", () => {
            textColorBtns.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTextSettings.color = btn.dataset.color;
            updateTextPreview();
        });
    });
    textSizeBtns.forEach(btn => {
        btn.addEventListener("click", () => {
            textSizeBtns.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTextSettings.size = btn.dataset.size;
            updateTextPreview();
        });
    });
    textPositionBtns.forEach(btn => {
        btn.addEventListener("click", () => {
            textPositionBtns.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            currentTextSettings.position = btn.dataset.position;
        });
    });

    applyTextBtn.addEventListener("click", () => {
        const targetFrames = getTargetFrames();
        if (targetFrames.length === 0) {
            showNotification("Vui lòng chọn một khung ảnh hoặc tất cả khung hình để thêm chú thích.", true);
            return;
        }

        targetFrames.forEach(activeFrame => {
            const imageContainer = activeFrame ? activeFrame.querySelector(".image-container") : null;
            if (imageContainer) {
                let captionElement = imageContainer.querySelector(".image-caption");
                if (!captionElement) {
                    captionElement = document.createElement("div");
                    captionElement.className = "image-caption absolute text-center w-full p-2 pointer-events-none";
                    imageContainer.appendChild(captionElement);
                }
                captionElement.textContent = currentTextSettings.text;
                captionElement.style.fontFamily = currentTextSettings.font;
                captionElement.style.color = currentTextSettings.color;
                let fontSize;
                switch (currentTextSettings.size) {
                    case "small":
                        fontSize = "12px";
                        break;
                    case "medium":
                        fontSize = "16px";
                        break;
                    case "large":
                        fontSize = "20px";
                        break;
                }
                captionElement.style.fontSize = fontSize;

                captionElement.style.top = "";
                captionElement.style.bottom = "";
                captionElement.style.left = "";
                captionElement.style.right = "";
                captionElement.style.transform = "";

                switch (currentTextSettings.position) {
                    case "top":
                        captionElement.style.top = "10px";
                        break;
                    case "middle":
                        captionElement.style.top = "50%";
                        captionElement.style.transform = "translateY(-50%)";
                        break;
                    case "bottom":
                        captionElement.style.bottom = "10px";
                        break;
                }
            }
        });
        showNotification(`Đã áp dụng chú thích cho ${isEditingAllFrames ? 'tất cả' : 'khung hình đang chọn'}!`);
    });

    // --- Chức năng Thêm và Quản lý Sticker ---
    const stickerData = {
        heart: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ff4d6d"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`,
        star: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ffd700"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`,
        smile: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ffcc00"><circle cx="12" cy="12" r="10" fill="#ffcc00"/><path d="M8 14s1.5 2 4 2 4-2 4-2" stroke="#000" stroke-width="1" fill="none"/><circle cx="9" cy="9" r="1.5" fill="#000"/><circle cx="15" cy="9" r="1.5" fill="#000"/></svg>`,
        camera: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#333"><path d="M9 3L7.17 5H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2h-3.17L15 3H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/><circle cx="12" cy="13" r="3"/></svg>`,
        location: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ff4d4d"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>`,
        like: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#3b82f6"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-1.91l-.01-.01L23 10z"/></svg>`,
        fire: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ff7700"><path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"/></svg>`,
        music: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#9333ea"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>`,
        sun: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#fbbf24"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>`,
        sparkles: `<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#a855f7"><path d="M11 2a1 1 0 0 1 2 0v5h5a1 1 0 0 1 0 2h-5v5a1 1 0 0 1-2 0v-5H4a1 1 0 0 1 0-2h5V2zm10 13a1 1 0 0 1-2 0v-2a1 1 0 0 1 2 0v2zm-2-6a1 1 0 0 1 0 2h-2a1 1 0 0 1 0-2h2zm-2 6a1 1 0 0 1 0 2h-2a1 1 0 0 1 0-2h2zm-4 4a1 1 0 0 1 0 2h-2a1 1 0 0 1 0-2h2zm-4-4a1 1 0 0 1 0 2H9a1 1 0 0 1 0-2h2zm-2-4a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2h2zM3 13a1 1 0 0 1 2 0v2a1 1 0 0 1-2 0v-2zM3 9a1 1 0 0 1 2 0v2a1 1 0 0 1-2 0V9zM7 5a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2h2z"></path></svg>`,
        "cloud-lightning": `<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#60a5fa"><path d="M19.34 8c-1.55-3.32-5.18-5.32-8.5-4.5-3.23.8-5.46 4.14-4.5 7.42-.51 1.09-.84 2.3-.92 3.58-.09 1.1.28 2.2.97 3.03.68.83 1.63 1.3 2.62 1.34h9.11c2.14.28 3.99-1.39 4.27-3.53.28-2.14-1.39-3.99-3.53-4.27zM11 12l-4 7h6l-3-6h3l-3-5z"></path></svg>`,
        coffee: `<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#9333ea"><path d="M18.5 12a2.5 2.5 0 0 0 0-5H18V4H6v3h.5a2.5 2.5 0 0 0 0 5H6v9h12v-9h.5zM16 19H8v-7h8v7zm-.5-5a.5.5 0 0 1-.5-.5.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5.5.5 0 0 1-.5.5h-2z"></path></svg>`,
        peace: `<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#a78bfa"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zM12 5l-7 7.01h14L12 5zm-7 8l-3 3.01H22l-3-3.01H5z"></path></svg>`,
        ghost: `<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#e2e8f0"><path d="M12 2C6.48 2 2 6.48 2 12c0 3.86 2.05 7.23 5.12 9.07l.88-1.53c-2.31-1.32-3.9-3.96-3.9-6.54 0-4.41 3.59-8 8-8s8 3.59 8 8c0 2.58-1.59 5.22-3.9 6.54l.88 1.53C20.95 19.23 23 15.86 23 12c0-5.52-4.48-10-10-10zm-4 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>`,
        cool: `<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="#0ea5e9"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14c-1.92 0-3.64-1.11-4.47-2.71l-.1-.2-.1-.21c-.81-1.61-.83-3.52-.06-5.11l.24-.5.17-.3c.75-1.37 2.06-2.28 3.51-2.28h.01c.2 0 .4.02.59.07l.1.02.21.05c1.61.35 2.87 1.8 2.87 3.5H12c0 1.93-1.57 3.5-3.5 3.5zm7-4h-2c-1.1 0-2 .9-2 2s.9 2 2 2h2v1H8v-1c-1.66 0-3-1.34-3-3s1.34-3 3-3h7c1.66 0 3 1.34 3 3s-1.34 3-3 3z"></path></svg>`,
        "cat-hat": `https://i.imgur.com/uT25c0x.png`,
        "cat-heart": `https://i.imgur.com/X4yK67s.png`,
        "cat-blush": `https://i.imgur.com/iR37yYt.png`,
        "cat-glasses": `https://i.imgur.com/vHq9q2d.png`,
        "cat-cute": `https://i.imgur.com/cE5aG1m.png`,
    };

    document.querySelectorAll(".sticker-item").forEach(stickerItem => {
        stickerItem.addEventListener("click", () => {
            if (!currentActiveFrameId) {
                showNotification("Vui lòng chọn một khung ảnh để thêm sticker.", true);
                return;
            }
            const activeFrame = document.getElementById(currentActiveFrameId);
            const imageContainer = activeFrame ? activeFrame.querySelector(".image-container") : null;
            if (imageContainer && imageContainer.querySelector("img")) {
                const stickerType = stickerItem.dataset.sticker;
                const newSticker = document.createElement("div");
                newSticker.className = "sticker";

                let stickerContent;
                if (stickerData[stickerType].startsWith('<svg')) {
                    stickerContent = stickerData[stickerType];
                } else {
                    stickerContent = `<img src="${stickerData[stickerType]}" alt="${stickerType}" class="w-16 h-16 object-contain">`;
                }

                newSticker.innerHTML = stickerContent + `
                    <div class="sticker-handle">
                        <svg class="w-3 h-3 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-5v4m0 0h-4m4 0l-5-5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 0h-4m4 0l-5 5"></path>
                        </svg>
                    </div>
                    <button class="sticker-remove">X</button>
                `;

                newSticker.style.width = "64px";
                newSticker.style.height = "64px";
                newSticker.style.left = "calc(50% - 32px)";
                newSticker.style.top = "calc(50% - 32px)";
                imageContainer.appendChild(newSticker);
                showNotification(`Đã thêm sticker ${stickerType}!`);

                setupStickerInteractions(newSticker, imageContainer);
            } else {
                showNotification("Vui lòng chọn một khung ảnh CÓ ẢNH để thêm sticker.", true);
            }
        });
    });

    function setupStickerInteractions(sticker, container) {
        let isDragging = false;
        let isResizing = false;
        let offsetX, offsetY;
        let initialWidth, initialHeight;
        let initialX, initialY;

        const handle = sticker.querySelector('.sticker-handle');
        const removeBtn = sticker.querySelector('.sticker-remove');

        const startInteraction = (e) => {
            const event = e.touches ? e.touches[0] : e;
            const rect = sticker.getBoundingClientRect();
            if (e.target === handle || e.target.closest('.sticker-handle')) {
                isResizing = true;
                initialWidth = rect.width;
                initialHeight = rect.height;
                initialX = event.clientX;
                initialY = event.clientY;
            } else if (e.target !== removeBtn && e.target.closest('.sticker') === sticker) {
                isDragging = true;
                offsetX = event.clientX - rect.left;
                offsetY = event.clientY - rect.top;
                sticker.style.cursor = 'grabbing';
            }
            sticker.style.transition = 'none';
            e.preventDefault();
        };

        const moveInteraction = (e) => {
            const event = e.touches ? e.touches[0] : e;
            if (isDragging) {
                const containerRect = container.getBoundingClientRect();
                let newLeft = event.clientX - containerRect.left - offsetX;
                let newTop = event.clientY - containerRect.top - offsetY;

                newLeft = Math.max(0, Math.min(newLeft, containerRect.width - sticker.offsetWidth));
                newTop = Math.max(0, Math.min(newTop, containerRect.height - sticker.offsetHeight));

                sticker.style.left = `${newLeft}px`;
                sticker.style.top = `${newTop}px`;
            } else if (isResizing) {
                const deltaX = event.clientX - initialX;
                const deltaY = event.clientY - initialY;
                const newSize = Math.max(30, Math.min(initialWidth + deltaX, initialHeight + deltaY));
                sticker.style.width = `${newSize}px`;
                sticker.style.height = `${newSize}px`;
            }
        };

        const endInteraction = () => {
            isDragging = false;
            isResizing = false;
            sticker.style.cursor = 'grab';
            sticker.style.transition = 'transform 0.2s';
        };

        sticker.addEventListener('mousedown', startInteraction);
        sticker.addEventListener('touchstart', startInteraction);
        document.addEventListener('mousemove', moveInteraction);
        document.addEventListener('touchmove', moveInteraction);
        document.addEventListener('mouseup', endInteraction);
        document.addEventListener('touchend', endInteraction);
        removeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            sticker.remove();
            showNotification("Đã xóa sticker!");
        });
    }

    // --- Chức năng Chụp ảnh từ webcam ---
    document.getElementById("captureBtn").addEventListener("click", async () => {
        cameraModal.classList.remove("hidden");
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: currentFacingMode } });
            cameraVideo.srcObject = stream;
            videoStream = stream;
        } catch (err) {
            console.error("Lỗi truy cập camera: ", err);
            showNotification("Không thể truy cập camera. Vui lòng kiểm tra quyền truy cập.", true);
        }
    });

    document.getElementById("closeCamera").addEventListener("click", () => {
        cameraModal.classList.add("hidden");
        if (videoStream) {
            videoStream.getTracks().forEach(track => track.stop());
        }
    });

    document.getElementById("switchCameraBtn").addEventListener("click", async () => {
        if (videoStream) {
            videoStream.getTracks().forEach(track => track.stop());
        }
        currentFacingMode = currentFacingMode === "user" ? "environment" : "user";
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: currentFacingMode } });
            cameraVideo.srcObject = stream;
            videoStream = stream;
            showNotification(`Đã chuyển sang camera ${currentFacingMode === "user" ? "trước" : "sau"}`);
        } catch (err) {
            console.error("Lỗi khi chuyển camera: ", err);
            showNotification("Không thể chuyển đổi camera.", true);
        }
    });

    // Chức năng chụp 1 ảnh
    document.getElementById("takePhotoBtn").addEventListener("click", () => {
        if (!videoStream) {
            showNotification("Vui lòng mở camera trước.", true);
            return;
        }
        takeSinglePhoto();
    });

    // Chức năng chụp Photobooth
    document.getElementById('takePhotoboothBtn').addEventListener('click', () => {
        if (!videoStream) {
            showNotification("Vui lòng mở camera trước.", true);
            return;
        }
        takePhotoboothSeries();
    });

    // *** BẮT ĐẦU SỬA LỖI ***

    // SỬA LỖI 1: Tối ưu hóa chức năng chụp 1 ảnh
    function takeSinglePhoto() {
        // Vô hiệu hóa các nút bấm để tránh người dùng bấm nhiều lần
        const takePhotoBtn = document.getElementById('takePhotoBtn');
        const takePhotoboothBtn = document.getElementById('takePhotoboothBtn');
        takePhotoBtn.disabled = true;
        takePhotoboothBtn.disabled = true;

        let countdown = 3;
        cameraCountdown.textContent = countdown;
        cameraCountdown.classList.remove("hidden");
        
        const interval = setInterval(() => {
            countdown--;
            if (countdown > 0) {
                cameraCountdown.textContent = countdown;
            } else {
                clearInterval(interval);
                cameraCountdown.classList.add("hidden");
                triggerFlash();
                const imageDataUrl = captureFrame();
                processPhoto(imageDataUrl);

                // Kích hoạt lại các nút bấm
                takePhotoBtn.disabled = false;
                takePhotoboothBtn.disabled = false;
                closeCamera.click(); // Tự động đóng camera sau khi chụp
            }
        }, 1000);
    }
    
    // SỬA LỖI 2: Thay thế hoàn toàn chức năng chụp Photobooth
    function takePhotoboothSeries() {
        // 1. Chuẩn bị gallery: Xóa các khung cũ và tạo 4 khung mới
        galleryContainer.innerHTML = '';
        for (let i = 0; i < 4; i++) {
            const newFrame = createPlaceholderFrame(`frame-photobooth-${i}`);
            galleryContainer.appendChild(newFrame);
        }
        
        // 2. Vô hiệu hóa các nút bấm trong khi chụp
        const takePhotoBtn = document.getElementById('takePhotoBtn');
        const takePhotoboothBtn = document.getElementById('takePhotoboothBtn');
        takePhotoBtn.disabled = true;
        takePhotoboothBtn.disabled = true;

        // 3. Bắt đầu chuỗi chụp ảnh
        let photoCount = 0;
        const totalPhotos = 4;
        
        const runPhotoSequence = () => {
            // Nếu đã chụp đủ 4 tấm, kết thúc
            if (photoCount >= totalPhotos) {
                showNotification("Hoàn thành chụp photobooth!", false);
                takePhotoBtn.disabled = false;
                takePhotoboothBtn.disabled = false;
                closeCamera.click();
                return;
            }

            // Bắt đầu đếm ngược cho tấm ảnh hiện tại
            let countdown = 3;
            photoboothCountdown.textContent = countdown;
            photoboothCountdown.classList.remove('hidden');

            const countdownTimer = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    photoboothCountdown.textContent = countdown;
                } else {
                    clearInterval(countdownTimer);
                    photoboothCountdown.classList.add('hidden');
                    
                    triggerFlash();
                    const imageDataUrl = captureFrame();
                    const targetFrameId = `frame-photobooth-${photoCount}`;
                    processPhoto(imageDataUrl, targetFrameId);
                    
                    photoCount++;
                    
                    // Đợi 1.5 giây trước khi bắt đầu chụp tấm tiếp theo
                    setTimeout(runPhotoSequence, 1500); 
                }
            }, 1000);
        };

        // Bắt đầu chụp tấm ảnh đầu tiên
        showNotification("Bắt đầu chụp photobooth!");
        runPhotoSequence();
    }
    
    // *** KẾT THÚC SỬA LỖI ***

    function captureFrame() {
        const canvas = document.createElement("canvas");
        canvas.width = cameraVideo.videoWidth;
        canvas.height = cameraVideo.videoHeight;
        const context = canvas.getContext("2d");
        // Lật ảnh ngang (mirror) nếu là camera trước để giống như soi gương
        if (currentFacingMode === 'user') {
            context.translate(canvas.width, 0);
            context.scale(-1, 1);
        }
        context.drawImage(cameraVideo, 0, 0, canvas.width, canvas.height);
        return canvas.toDataURL("image/png");
    }
    
    // Cập nhật logic processPhoto để có thể chỉ định khung ảnh đích
    function processPhoto(imageDataUrl, frameId = null) {
        let targetFrame = frameId ? document.getElementById(frameId) : document.getElementById(currentActiveFrameId);
        let placeholder = targetFrame ? targetFrame.querySelector(".image-placeholder") : null;

        if (!targetFrame || !placeholder) {
            document.getElementById("addFrameBtn").click();
            targetFrame = galleryContainer.lastElementChild;
            placeholder = targetFrame.querySelector(".image-placeholder");
        }

        if (placeholder) {
            const imageContainer = document.createElement("div");
            imageContainer.className = "image-container";
            imageContainer.innerHTML = `
                <img src="${imageDataUrl}" alt="Ảnh chụp" class="edited-image">
                <div class="film-date">${new Date().toISOString().slice(0, 10)}</div>
                <div class="film-brand">FUJIFILM</div>
                <div class="image-actions">
                    <button class="action-btn edit-btn" title="Chỉnh sửa">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                        </svg>
                    </button>
                    <button class="action-btn delete-btn" title="Xóa">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
            `;
            placeholder.replaceWith(imageContainer);
            setupImageActions(imageContainer.closest('.film-frame'));
            setActiveFrame(targetFrame.id);
            showNotification("Đã chụp ảnh thành công!");
            updateFilmDetailsVisibility();
        }
    }

    // --- Chức năng Tải xuống (Download) ---
    document.getElementById("downloadBtn").addEventListener("click", () => {
        const targetElement = document.getElementById("galleryContainer");
        if (!targetElement.children.length) {
            showNotification("Không có ảnh nào để tải xuống.", true);
            return;
        }

        const originalState = {
            filmBrands: [],
            filmDates: []
        };
        const showBrandChecked = document.getElementById("showBrandCheckbox").checked;
        const showDateChecked = document.getElementById("showDateCheckbox").checked;

        const actionButtons = targetElement.querySelectorAll(".image-actions");
        actionButtons.forEach(btn => btn.style.display = "none");

        const filmBrands = targetElement.querySelectorAll(".film-brand");
        filmBrands.forEach(el => {
            originalState.filmBrands.push(el.style.display);
            el.style.display = showBrandChecked ? "block" : "none";
        });

        const filmDates = targetElement.querySelectorAll(".film-date");
        filmDates.forEach(el => {
            originalState.filmDates.push(el.style.display);
            el.style.display = showDateChecked ? "block" : "none";
        });

        showNotification("Đang chuẩn bị tải xuống ảnh...", false);

        html2canvas(targetElement, {
            scale: 2,
            useCORS: true,
            logging: true,
            allowTaint: true,
        }).then(canvas => {
            actionButtons.forEach(btn => btn.style.display = "flex");
            filmBrands.forEach((el, index) => el.style.display = originalState.filmBrands[index]);
            filmDates.forEach((el, index) => el.style.display = originalState.filmDates[index]);

            const link = document.createElement("a");
            link.download = `tandev-foto-studio-collection-${Date.now()}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
            showNotification("Bộ sưu tập đã được tải xuống thành công!");
        }).catch(error => {
            console.error("Lỗi khi tạo ảnh:", error);
            actionButtons.forEach(btn => btn.style.display = "flex");
            filmBrands.forEach((el, index) => el.style.display = originalState.filmBrands[index]);
            filmDates.forEach((el, index) => el.style.display = originalState.filmDates[index]);
            showNotification("Lỗi khi tạo ảnh. Vui lòng thử lại.", true);
        });
    });

    // --- Chức năng Hiển thị Ngày tháng và Nhãn Fujifilm ---
    const showDateCheckbox = document.getElementById("showDateCheckbox");
    const showBrandCheckbox = document.getElementById("showBrandCheckbox");

    function updateFilmDetailsVisibility() {
        const filmDates = document.querySelectorAll(".film-date");
        const filmBrands = document.querySelectorAll(".film-brand");

        filmDates.forEach(el => {
            el.style.display = showDateCheckbox.checked ? "block" : "none";
        });
        filmBrands.forEach(el => {
            el.style.display = showBrandCheckbox.checked ? "block" : "none";
        });
    }

    showDateCheckbox.addEventListener("change", updateFilmDetailsVisibility);
    showBrandCheckbox.addEventListener("change", updateFilmDetailsVisibility);
    updateFilmDetailsVisibility();

    // Cập nhật preview của filter khi hình ảnh được tải
    function updateFilterPreviews() {
        const firstImage = galleryContainer.querySelector('.edited-image');
        if (firstImage) {
            const firstImageUrl = firstImage.src;
            document.querySelectorAll('.filter-preview').forEach(preview => {
                preview.style.backgroundImage = `url('${firstImageUrl}')`;
            });
        }
    }

    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === 'childList' || mutation.type === 'attributes') {
                updateFilterPreviews();
            }
        });
    });

    observer.observe(galleryContainer, {
        childList: true,
        subtree: true,
        attributes: true
    });

    // --- Tab Switching Logic ---
    document.querySelectorAll(".tab-btn").forEach(button => {
        button.addEventListener("click", () => {
            document.querySelectorAll(".tab-btn").forEach(btn => {
                btn.classList.remove("active", "text-red-500", "border-red-500");
                btn.classList.add("border-transparent", "hover:text-gray-600");
            });
            document.querySelectorAll(".tab-content").forEach(content => content.classList.remove("active"));
            button.classList.add("active", "text-red-500", "border-red-500");
            button.classList.remove("border-transparent", "hover:text-gray-600");
            document.getElementById(button.dataset.tab + "Tab").classList.add("active");
            showNotification(`Đã chuyển sang tab ${button.textContent.trim()}!`);
        });
    });

    // --- Final Initialization ---
    document.querySelector('#filtersTab .filter-option[data-filter="none"]').click();
    updateTextPreview();

    document.querySelector('.frame-type-btn[data-frame="film"]').click();
    document.querySelector('.frame-color-btn[data-color="white"]').click();


    // --- Chức năng Chia sẻ ---
    const shareBtn = document.getElementById("shareBtn");
    const shareModal = document.getElementById("shareModal");
    const closeShareModal = document.getElementById("closeShareModal");
    const shareLoading = document.getElementById("shareLoading");
    const shareContent = document.getElementById("shareContent");
    const qrcodeDiv = document.getElementById("qrcode");
    const shareFacebookBtn = document.getElementById("shareFacebook");
    const shareZaloBtn = document.getElementById("shareZalo");
    const shareEmailBtn = document.getElementById("shareEmail");
    const copyLinkBtn = document.getElementById("copyLinkBtn");
    let shareImageUrl = '';

    async function createShareImage() {
        const targetElement = document.getElementById("galleryContainer");
        if (!targetElement.children.length) {
            showNotification("Không có ảnh nào để chia sẻ.", true);
            return;
        }

        shareModal.classList.remove("hidden");
        shareContent.classList.add("hidden");
        shareLoading.classList.remove("hidden");

        // Tạm ẩn các nút và chi tiết không mong muốn trước khi chụp ảnh
        const actionButtons = targetElement.querySelectorAll(".image-actions");
        const originalActionDisplays = Array.from(actionButtons).map(btn => btn.style.display);
        actionButtons.forEach(btn => btn.style.display = "none");
        const filmDetails = targetElement.querySelectorAll(".film-date, .film-brand");
        const originalDetailDisplays = Array.from(filmDetails).map(el => el.style.display);
        filmDetails.forEach(el => el.style.display = "block");

        // Lấy màu nền của body để đảm bảo ảnh chụp không bị trong suốt
        const originalBgColor = document.body.style.backgroundColor;
        document.body.style.backgroundColor = document.body.classList.contains('dark') ? '#1a1a1a' : '#f8f9fa';

        try {
            const canvas = await html2canvas(targetElement, {
                scale: 2,
                useCORS: true,
                logging: true,
                allowTaint: true,
            });

            // Khôi phục trạng thái ban đầu sau khi chụp ảnh
            actionButtons.forEach((btn, index) => btn.style.display = originalActionDisplays[index]);
            filmDetails.forEach((el, index) => el.style.display = originalDetailDisplays[index]);
            document.body.style.backgroundColor = originalBgColor;

            shareLoading.classList.add("hidden");
            shareContent.classList.remove("hidden");

            return canvas;

        } catch (error) {
            console.error("Lỗi khi tạo ảnh:", error);
            actionButtons.forEach((btn, index) => btn.style.display = originalActionDisplays[index]);
            filmDetails.forEach((el, index) => el.style.display = originalDetailDisplays[index]);
            document.body.style.backgroundColor = originalBgColor;
            shareLoading.classList.add("hidden");
            shareModal.classList.add("hidden");
            showNotification("Lỗi khi tạo ảnh. Vui lòng thử lại.", true);
            return null;
        }
    }
    
    shareBtn.addEventListener("click", async () => {
        const canvas = await createShareImage();
        if (!canvas) return;

        const shareDataUrl = canvas.toDataURL("image/png");
        shareImageUrl = shareDataUrl;

        // Xử lý chia sẻ qua QR code và copy link
        qrcodeDiv.innerHTML = "";
        new QRCode(qrcodeDiv, {
            text: shareDataUrl,
            width: 180,
            height: 180,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H,
        });
        
        // Gắn sự kiện copy link vào nút
        copyLinkBtn.onclick = () => {
            navigator.clipboard.writeText(shareDataUrl)
                .then(() => showNotification("Đã sao chép link ảnh thành công!"))
                .catch(() => showNotification("Lỗi khi sao chép link. Vui lòng thử lại.", true));
        };

        // Chức năng chia sẻ qua email
        const emailSubject = encodeURIComponent("Bộ sưu tập ảnh film của tôi");
        const emailBody = encodeURIComponent(`Chào bạn,\n\nĐây là bộ sưu tập ảnh film độc đáo của tôi được tạo từ Tandev.foto Studio.\n\nBạn có thể tải ảnh này xuống bằng cách quét mã QR hoặc truy cập đường link dưới đây:\n\n${shareDataUrl}\n\nChúc bạn vui vẻ!`);
        shareEmailBtn.href = `mailto:?subject=${emailSubject}&body=${emailBody}`;

        // Thông báo đã sẵn sàng
        showNotification("Đã sẵn sàng để chia sẻ!");

        // Gắn sự kiện chia sẻ qua Facebook và Zalo
        // Các nền tảng này thường không hỗ trợ chia sẻ Data URL trực tiếp,
        // nên chúng ta sẽ tạo một chức năng để người dùng tải ảnh về trước
        // rồi tự chia sẻ lên mạng xã hội. Hoặc bạn có thể triển khai thêm
        // một API backend để lưu ảnh và tạo ra một URL công khai.
        shareFacebookBtn.onclick = () => {
            alert("Để chia sẻ lên Facebook, bạn vui lòng Tải xuống ảnh rồi đăng thủ công lên trang cá nhân hoặc hội nhóm.");
        };

        shareZaloBtn.onclick = () => {
            alert("Để chia sẻ qua Zalo, bạn vui lòng Tải xuống ảnh rồi gửi thủ công cho bạn bè hoặc nhóm.");
        };

        // Cập nhật button "Tải xuống" để làm rõ hơn
        shareBtn.querySelector('span').textContent = 'Chia sẻ';
        shareBtn.title = 'Chia sẻ bộ sưu tập lên mạng xã hội';
    });

    closeShareModal.addEventListener("click", () => {
        shareModal.classList.add("hidden");
    });

    // Initialize checkbox states and event listeners
    allFramesCheckboxes.filters.addEventListener('change', (e) => {
        isEditingAllFrames = e.target.checked;
        allFramesCheckboxes.effects.checked = e.target.checked;
        document.querySelectorAll('.film-frame').forEach(frame => {
            if (isEditingAllFrames) {
                frame.classList.add('selected-all');
                frame.classList.remove('active-edit-frame');
            } else {
                frame.classList.remove('selected-all');
            }
        });
        if (isEditingAllFrames) {
            showNotification('Đã chọn tất cả khung hình. Mọi thay đổi sẽ được áp dụng đồng bộ.');
            setActiveFrame(null);
        } else if (galleryContainer.firstElementChild) {
            setActiveFrame(galleryContainer.firstElementChild.id);
        }
    });

    allFramesCheckboxes.effects.addEventListener('change', (e) => {
        isEditingAllFrames = e.target.checked;
        allFramesCheckboxes.filters.checked = e.target.checked;
        document.querySelectorAll('.film-frame').forEach(frame => {
            if (isEditingAllFrames) {
                frame.classList.add('selected-all');
                frame.classList.remove('active-edit-frame');
            } else {
                frame.classList.remove('selected-all');
            }
        });
        if (isEditingAllFrames) {
            showNotification('Đã chọn tất cả khung hình. Mọi thay đổi sẽ được áp dụng đồng bộ.');
            setActiveFrame(null);
        } else if (galleryContainer.firstElementChild) {
            setActiveFrame(galleryContainer.firstElementChild.id);
        }
    });
    
    // --- Chức năng Tách nền tự động bằng AI ---
    // Thêm sự kiện click cho nút "Tách nền"
    removeBgBtn.addEventListener("click", async () => {
        const targetFrames = getTargetFrames();
        if (targetFrames.length === 0) {
            showNotification("Vui lòng chọn một khung ảnh có hình ảnh để tách nền.", true);
            return;
        }
        if (targetFrames.length > 1) {
            showNotification("Bạn chỉ có thể tách nền cho một khung ảnh tại một thời điểm.", true);
            return;
        }

        const activeFrame = targetFrames[0];
        const firstImage = activeFrame.querySelector("img");
        if (!firstImage) {
            showNotification("Khung ảnh được chọn chưa có hình ảnh.", true);
            return;
        }
        if (activeFrame.classList.contains('processing')) {
            showNotification("Ảnh đang được xử lý, vui lòng đợi.", true);
            return;
        }

        // Hiển thị loading và vô hiệu hóa nút
        removeBgBtn.disabled = true;
        removeBgBtnText.textContent = "Đang xử lý...";
        removeBgSpinner.classList.remove("hidden");
        activeFrame.classList.add('processing');

        try {
            // Sử dụng fetch API để tải ảnh gốc
            const response = await fetch(firstImage.src);
            if (!response.ok) {
                throw new Error('Lỗi khi tải ảnh gốc.');
            }
            const blob = await response.blob();

            const formData = new FormData();
            formData.append("image_file", blob, "image.png");
            formData.append("size", "auto");
            
            const removeBgResponse = await fetch("https://api.remove.bg/v1.0/removebg", {
                method: "POST",
                headers: {
                    "X-Api-Key": REMOVE_BG_API_KEY,
                    "Accept": "image/png" // Yêu cầu trả về trực tiếp ảnh
                },
                body: formData
            });

            if (!removeBgResponse.ok) {
                throw new Error(`Lỗi API: ${removeBgResponse.status} ${removeBgResponse.statusText}`);
            }

            const removedBgBlob = await removeBgResponse.blob();
            const removedBgImageSrc = URL.createObjectURL(removedBgBlob);
            
            // Lưu lại ảnh gốc và ảnh đã tách nền vào dataset của frame
            activeFrame.dataset.originalSrc = firstImage.src;
            activeFrame.dataset.removedBgSrc = removedBgImageSrc;
            
            // Áp dụng ảnh đã tách nền
            firstImage.src = removedBgImageSrc;
            
            // Cập nhật trạng thái và hiển thị tùy chọn nền
            backgroundOptionsDiv.classList.remove("hidden");
            document.getElementById('removeBgBtn').classList.add('hidden');
            showNotification("Đã tách nền ảnh thành công!");
        } catch (error) {
            console.error("Lỗi khi tách nền:", error);
            showNotification(`Lỗi khi tách nền: ${error.message}`, true);
        } finally {
            // Khôi phục trạng thái ban đầu của nút
            removeBgBtn.disabled = false;
            removeBgBtnText.textContent = "Tách nền";
            removeBgSpinner.classList.add("hidden");
            activeFrame.classList.remove('processing');
        }
    });


    // Thêm sự kiện lắng nghe khi người dùng chọn một nền mới
    backgroundOptionInputs.forEach(input => {
        input.addEventListener('change', (e) => {
            const backgroundValue = e.target.value;
            const targetFrames = getTargetFrames();
            
            if (targetFrames.length === 0) {
                showNotification("Vui lòng chọn một khung ảnh để áp dụng nền.", true);
                return;
            }

            targetFrames.forEach(frame => {
                updateImageWithBackground(frame, backgroundValue);
            });

            showNotification("Đã áp dụng nền mới!");
        });
    });

    // Hàm cập nhật hình ảnh với nền mới
    function updateImageWithBackground(frame, backgroundValue) {
        const imgContainer = frame.querySelector(".image-container");
        const img = imgContainer.querySelector("img");

        if (!img || !frame.dataset.removedBgSrc) {
            // Nếu ảnh chưa được tách nền hoặc không có ảnh, không làm gì cả
            return;
        }
        
        if (backgroundValue === "original") {
            // Nếu chọn "Nền gốc", khôi phục lại ảnh ban đầu
            img.src = frame.dataset.originalSrc;
            // Ẩn lại nút tách nền và tùy chọn nền
            document.getElementById('removeBgBtn').classList.remove('hidden');
            backgroundOptionsDiv.classList.add('hidden');
        } else {
            // Nếu chọn một nền mới, tạo canvas để kết hợp ảnh đã tách nền và nền mới
            
            const canvas = document.createElement("canvas");
            canvas.className = "background-canvas absolute inset-0 -z-10"; // Nền nằm ở lớp dưới
            
            const removedBgImg = new Image();
            removedBgImg.crossOrigin = "anonymous";
            removedBgImg.onload = () => {
                canvas.width = removedBgImg.width;
                canvas.height = removedBgImg.height;

                const ctx = canvas.getContext('2d');
                
                const bgImg = new Image();
                bgImg.crossOrigin = "anonymous";
                bgImg.onload = () => {
                    ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
                    ctx.drawImage(removedBgImg, 0, 0, canvas.width, canvas.height);
                    img.src = canvas.toDataURL();
                };
                
                // Xử lý các tùy chọn nền màu
                if (backgroundValue === "white-bg") {
                    bgImg.src = "data:image/svg+xml;base64," + btoa('<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"><rect width="1" height="1" fill="white"/></svg>');
                } else if (backgroundValue === "black-bg") {
                    bgImg.src = "data:image/svg+xml;base64," + btoa('<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"><rect width="1" height="1" fill="black"/></svg>');
                } else if (backgroundValue === "color-bg") {
                                // Sử dụng Canvas để tạo gradient màu
                                const tempCanvas = document.createElement('canvas');
                                const tempCtx = tempCanvas.getContext('2d');
                                tempCanvas.width = canvas.width;
                                tempCanvas.height = canvas.height;
                                const gradient = tempCtx.createLinearGradient(0, 0, tempCanvas.width, tempCanvas.height);
                                gradient.addColorStop(0, '#ef4444');
                                gradient.addColorStop(0.5, '#facc15');
                                gradient.addColorStop(1, '#22c55e');
                                tempCtx.fillStyle = gradient;
                                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                                bgImg.src = tempCanvas.toDataURL();
                } else {
                    bgImg.src = backgroundValue;
                }
            };
            removedBgImg.src = frame.dataset.removedBgSrc;
        }
    }
    
    // Gọi hàm để tạo 4 khung mặc định khi trang web được tải
    createDefaultPlaceholders();
  });
</script>

    </body>
  </html>